<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Palmarés de TuSoccerManager</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary-color: #2c3e50;
            --primary-light: #34495e;
            --secondary-color: #f8fafc;
            --accent-color: #e53e3e;
            --accent-hover: #c53030;
            --light-bg: #ffffff;
            --dark-text: #2d3748;
            --light-text: #ffffff;
            --border-color: #e2e8f0;
            --highlight-champion: rgba(255, 215, 0, 0.3);
            --highlight-champion-border: rgba(255, 215, 0, 0.7);
            --highlight-runnerup: rgba(192, 192, 192, 0.3);
            --highlight-runnerup-border: rgba(192, 192, 192, 0.7);
            --card-shadow: 0 4px 6px rgba(0, 0, 0, 0.05), 0 1px 3px rgba(0, 0, 0, 0.1);
            --hover-shadow: 0 10px 15px rgba(0, 0, 0, 0.1), 0 4px 6px rgba(0, 0, 0, 0.05);
            --transition-speed: 0.3s;
            --season-header-start: #a0aec0;
            --season-header-end: #2c3e50;
            --bg-color: #f1f5f9;
            --surface-color: #ffffff;
            --text-color: #2d3748;
            --text-secondary: #4a5568;
            --header-bg: #2c3e50;
        }

        body.dark-mode {
            --bg-color: #121826;
            --surface-color: #1e293b;
            --text-color: #e2e8f0;
            --text-secondary: #94a3b8;
            --border-color: #334155;
            --header-bg: #0f172a;
            --primary-color: #60a5fa;
            --primary-light: #3b82f6;
            --secondary-color: #1e293b;
            --light-bg: #1e293b;
            --dark-text: #e2e8f0;
            --light-text: #f1f5f9;
            --season-header-start: #334155;
            --season-header-end: #475569;
            --card-shadow: 0 4px 6px rgba(0, 0, 0, 0.2), 0 1px 3px rgba(0, 0, 0, 0.3);
            --hover-shadow: 0 10px 15px rgba(0, 0, 0, 0.3), 0 4px 6px rgba(0, 0, 0, 0.2);
            --highlight-champion: rgba(255, 215, 0, 0.2);
            --highlight-runnerup: rgba(192, 192, 192, 0.2);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            transition: background-color var(--transition-speed), color var(--transition-speed);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        header {
            background-color: var(--header-bg);
            color: var(--light-text);
            padding: 1rem 0;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
        }

        header h1 {
            font-size: 2.2rem;
            font-weight: 600;
            color: #ffffff;
            cursor: pointer;
            transition: transform var(--transition-speed) ease;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin: 0;
        }

        header h1:hover {
            transform: scale(1.05);
        }

        .menu {
            position: relative;
            display: inline-block;
            z-index: 80;
        }

        .menu-trigger {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-light));
            color: var(--light-text);
            padding: 0.8rem 1.5rem;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all var(--transition-speed) ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .menu-trigger:hover {
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            transform: translateY(-2px);
        }

        .menu-trigger i {
            margin-left: 0.8rem;
            font-size: 0.8rem;
            transition: transform var(--transition-speed) ease;
        }

        .menu-trigger span {
            margin-right: 0.5rem;
        }

        .menu.active .menu-trigger i {
            transform: rotate(180deg);
        }

        .menu-content {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            background-color: var(--surface-color);
            box-shadow: var(--card-shadow);
            z-index: 90;
            padding: 1rem;
            border-radius: 10px;
            width: 1200px;
            flex-direction: row;
            justify-content: space-between;
            opacity: 0;
            transform: translateY(-10px);
            transition: opacity var(--transition-speed) ease, transform var(--transition-speed) ease;
            max-height: 500px;
            overflow-y: auto;
        }

        .menu-content::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }

        .menu-content::-webkit-scrollbar-track {
            background: var(--secondary-color);
            border-radius: 10px;
        }

        .menu-content::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-light));
            border-radius: 10px;
            border: 2px solid var(--secondary-color);
        }

        .menu-content::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, var(--primary-light), var(--primary-color));
        }

        .menu-content.active {
            display: flex;
            opacity: 1;
            transform: translateY(0);
        }

        .menu-section {
            margin-right: 0.5rem;
            flex: 1;
        }

        .menu-section:last-child {
            margin-right: 0;
        }

        .menu-section h3 {
            color: var(--primary-color);
            margin-bottom: 0.5rem;
            font-weight: 600;
            font-size: 0.95rem;
            position: relative;
            padding-bottom: 0.3rem;
        }

        .menu-section h3::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 30px;
            height: 2px;
            background-color: var(--accent-color);
            border-radius: 2px;
        }

        .menu-section ul {
            list-style: none;
            padding: 0;
        }

        .menu-section.senior ul {
            column-count: 4;
            column-gap: 0.8rem;
        }

        .menu-section.national ul,
        .menu-section.filial ul {
            column-count: 1;
        }

        .menu-section li {
            margin: 0.05rem 0;
            break-inside: avoid;
        }

        .menu-section a {
            color: var(--primary-color);
            text-decoration: none;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            transition: all var(--transition-speed) ease;
            padding: 0.2rem 0.4rem;
            border-radius: 3px;
            line-height: 1.3;
        }

        .menu-section a i {
            margin-right: 0.4rem;
            font-size: 0.7rem;
            color: var(--accent-color);
        }

        .menu-section a:hover {
            color: var(--accent-color);
            background-color: rgba(0, 0, 0, 0.03);
            transform: translateX(3px);
        }

        .dark-mode-toggle {
            background: transparent;
            border: none;
            color: var(--light-text);
            font-size: 1.5rem;
            cursor: pointer;
            margin-left: 1rem;
            transition: transform var(--transition-speed) ease;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }

        .dark-mode-toggle:hover {
            transform: scale(1.1);
            background-color: rgba(255, 255, 255, 0.1);
        }

        .search-container {
            position: relative;
            width: 400px;
            display: flex;
            align-items: center;
        }

        .search-input {
            width: 100%;
            padding: 0.8rem 1rem 0.8rem 2.5rem;
            font-size: 1rem;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            outline: none;
            transition: all var(--transition-speed) ease;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23a0aec0' width='18px' height='18px'%3E%3Cpath d='M15.5 14h-.79l-.28-.27a6.5 6.5 0 0 0 1.48-5.34c-.47-2.78-2.79-5-5.59-5.34a6.505 6.505 0 0 0-7.27 7.27c.34 2.8 2.56 5.12 5.34 5.59a6.5 6.5 0 0 0 5.34-1.48l.27.28v.79l4.25 4.25c.41.41 1.08.41 1.49 0 .41-.41.41-1.08 0-1.49L15.5 14zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: 0.7rem center;
            background-size: 1.2rem;
            background-color: var(--surface-color);
            color: var(--text-color);
        }

        .search-input:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(44, 62, 80, 0.1);
        }

        .suggestions {
            position: absolute;
            top: 110%;
            left: 0;
            width: 100%;
            list-style: none;
            padding: 0;
            margin: 0;
            background-color: var(--surface-color);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            max-height: 300px;
            overflow-y: auto;
            z-index: 1100;
            display: none;
            box-shadow: var(--card-shadow);
        }

        .suggestions::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }

        .suggestions::-webkit-scrollbar-track {
            background: var(--secondary-color);
            border-radius: 10px;
        }

        .suggestions::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-light));
            border-radius: 10px;
            border: 2px solid var(--secondary-color);
        }

        .suggestions::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, var(--primary-light), var(--primary-color));
        }

        .suggestions li {
            padding: 0.8rem 1rem;
            cursor: pointer;
            transition: background-color var(--transition-speed) ease;
            border-bottom: 1px solid var(--border-color);
            color: var(--text-color);
        }

        .suggestions li:nth-child(even) {
            background-color: rgba(0, 0, 0, 0.03);
        }

        .suggestions li:hover,
        .suggestions li.selected {
            background-color: rgba(66, 153, 225, 0.1);
        }

        .suggestions.visible {
            display: block;
        }

        .teams-list {
            list-style: none;
            padding: 0;
            margin: 1rem 0;
            max-height: 400px;
            overflow-y: auto;
        }

        .teams-list::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }

        .teams-list::-webkit-scrollbar-track {
            background: var(--secondary-color);
            border-radius: 10px;
        }

        .teams-list::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-light));
            border-radius: 10px;
            border: 2px solid var(--secondary-color);
        }

        .teams-list::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, var(--primary-light), var(--primary-color));
        }

        .teams-list li {
            padding: 0.5rem;
            cursor: pointer;
            transition: background-color var(--transition-speed) ease;
            color: var(--text-color);
        }

        .teams-list li:hover {
            background-color: rgba(66, 153, 225, 0.1);
        }

        .cards-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.5rem;
            margin-bottom: 2.5rem;
        }

        .card {
            background-color: var(--surface-color);
            border-radius: 10px;
            box-shadow: var(--card-shadow);
            padding: 1.5rem;
            text-align: center;
            position: relative;
            overflow: hidden;
            transition: all var(--transition-speed) ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: var(--hover-shadow);
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-color), var(--accent-color));
        }

        .card h3 {
            color: var(--primary-color);
            margin-bottom: 0.5rem;
            font-weight: 600;
            font-size: 1.1rem;
        }

        .card img {
            width: 48px;
            height: 48px;
            margin: 0.5rem auto;
            display: block;
        }

        .card p {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--accent-color);
        }

        .star {
            position: absolute;
            top: 1rem;
            right: 1rem;
            color: var(--primary-color);
            font-size: 1.2rem;
            opacity: 0.8;
        }

        .clickable {
            cursor: pointer;
            color: var(--accent-color);
            position: relative;
            display: inline-block;
            transition: all var(--transition-speed) ease;
        }

        .clickable::after {
            content: '';
            position: absolute;
            width: 100%;
            height: 2px;
            bottom: -2px;
            left: 0;
            background-color: var(--accent-color);
            transform: scaleX(0);
            transition: transform var(--transition-speed) ease;
            transform-origin: bottom right;
        }

        .clickable:hover {
            color: var(--accent-hover);
        }

        .clickable:hover::after {
            transform: scaleX(1);
            transform-origin: bottom left;
        }

        .competition {
            background-color: var(--surface-color);
            border-radius: 10px;
            box-shadow: var(--card-shadow);
            margin-bottom: 2rem;
            overflow: hidden;
            transition: all var(--transition-speed) ease, opacity 0.5s ease;
        }

        .competition:hover {
            box-shadow: var(--hover-shadow);
        }

        .competition-header {
            background: linear-gradient(90deg, var(--season-header-start), var(--season-header-end));
            color: var(--light-text);
            padding: 1rem 1.5rem;
            font-size: 1.2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 500;
        }

        .competition-header small {
            font-size: 0.8rem;
            font-style: italic;
            color: #ddd;
        }

        .competition-body {
            padding: 1.8rem;
        }

        .team-selector-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.2rem;
        }

        .team-selector {
            display: flex;
            align-items: center;
        }

        .team-selector select {
            padding: 0.5rem 1rem;
            font-size: 0.9rem;
            border-radius: 6px;
            border: 1px solid var(--border-color);
            background-color: var(--surface-color);
            color: var(--text-color);
            margin-right: 1rem;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%232d3748' width='18px' height='18px'%3E%3Cpath d='M7 10l5 5 5-5z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 0.7rem center;
            padding-right: 2rem;
            transition: all var(--transition-speed) ease;
        }

        .team-selector select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(44, 62, 80, 0.1);
        }

        .info {
            font-weight: 600;
            font-size: 0.9rem;
            color: var(--accent-color);
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 0.3rem;
        }

        table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            margin-bottom: 1.5rem;
            background-color: var(--surface-color);
            font-size: 0.9rem;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
            position: relative;
        }

        th,
        td {
            padding: 1rem 1.2rem;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
            color: var(--text-color);
        }

        th {
            background-color: var(--secondary-color);
            color: var(--primary-color);
            font-weight: 600;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            position: sticky;
            top: 0;
            z-index: 3;
        }

        th:first-child,
        td:first-child {
            position: sticky;
            left: 0;
            background-color: var(--secondary-color);
            z-index: 2;
        }

        td:first-child {
            background-color: var(--surface-color);
        }

        .team-cell,
        .manager-cell {
            cursor: pointer;
            color: var(--primary-color);
            font-weight: 500;
            transition: color var(--transition-speed) ease;
        }

        .team-cell:hover,
        .manager-cell:hover {
            color: var(--accent-color);
        }

        tr:last-child td {
            border-bottom: none;
        }

        tr {
            transition: background-color var(--transition-speed) ease;
        }

        tr:hover {
            background-color: rgba(66, 153, 225, 0.05);
        }

        .highlight-champion {
            background-color: var(--highlight-champion) !important;
            border-left: 3px solid var(--highlight-champion-border);
        }

        .highlight-runnerup {
            background-color: var(--highlight-runnerup) !important;
            border-left: 3px solid var(--highlight-runnerup-border);
        }

        .rankings-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
            opacity: 0;
            transition: opacity 0.5s ease;
        }

        .rankings-container.visible {
            opacity: 1;
        }

        .ranking-table {
            background-color: var(--surface-color);
            padding: 1.5rem;
            border-radius: 10px;
            box-shadow: var(--card-shadow);
            transition: all var(--transition-speed) ease;
        }

        .ranking-table:hover {
            box-shadow: var(--hover-shadow);
        }

        .ranking-table h3 {
            font-size: 1.1rem;
            margin-bottom: 1rem;
            color: var(--primary-color);
            font-weight: 600;
            position: relative;
            padding-bottom: 0.5rem;
        }

        .ranking-table h3::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 40px;
            height: 3px;
            background-color: var(--accent-color);
            border-radius: 2px;
        }

        .btn {
            background: linear-gradient(135deg, var(--accent-color), var(--accent-hover));
            color: var(--light-text);
            border: none;
            padding: 0.7rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9rem;
            transition: all var(--transition-speed) ease;
            box-shadow: 0 2px 4px rgba(229, 62, 62, 0.3);
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        #teams-button {
            padding: 0.7rem;
            margin-right: 0.5rem;
        }

        .btn.random {
            background: linear-gradient(135deg, #4a90e2, #357abd);
            box-shadow: 0 2px 4px rgba(74, 144, 226, 0.3);
        }

        .btn.purple {
            background: linear-gradient(135deg, #6a0dad, #4b0082);
            box-shadow: 0 2px 4px rgba(106, 13, 173, 0.3);
        }

        .btn i {
            margin-right: 0.5rem;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(229, 62, 62, 0.4);
        }

        .btn.random:hover {
            box-shadow: 0 4px 8px rgba(74, 144, 226, 0.4);
        }

        .btn.purple:hover {
            box-shadow: 0 4px 8px rgba(106, 13, 173, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            transition: opacity var(--transition-speed) ease;
        }

        .modal.visible {
            display: flex;
            opacity: 1;
        }

        .modal-content {
            background: var(--surface-color);
            padding: 2rem;
            border-radius: 10px;
            max-width: 650px;
            width: 100%;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            position: relative;
            transform: translateY(20px);
            transition: transform var(--transition-speed) ease;
        }

        .modal.visible .modal-content {
            transform: translateY(0);
        }

        /* Estilos específicos para el modal de ranking */
        #ranking-modal .modal-content {
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            padding: 1.5rem;
        }

        #ranking-modal .teams-list {
            max-height: 300px;
        }

        .close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            color: var(--accent-color);
            font-size: 1.5rem;
            cursor: pointer;
            transition: all var(--transition-speed) ease;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }

        .close:hover {
            color: var(--accent-hover);
            background-color: rgba(0, 0, 0, 0.05);
        }

        .copy-achievements {
            position: absolute;
            bottom: 1rem;
            right: 1rem;
            background: none;
            border: none;
            color: var(--accent-color);
            font-size: 1.2rem;
            cursor: pointer;
            transition: transform var(--transition-speed) ease;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }

        .copy-achievements:hover {
            transform: scale(1.1);
            background-color: rgba(0, 0, 0, 0.05);
        }

        .achievements-scroll {
            max-height: 400px;
            overflow-y: auto;
            padding-right: 1rem;
        }

        .achievements-scroll::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }

        .achievements-scroll::-webkit-scrollbar-track {
            background: var(--secondary-color);
            border-radius: 10px;
        }

        .achievements-scroll::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, var(--primary-color), var(--primary-light));
            border-radius: 10px;
            border: 2px solid var(--secondary-color);
        }

        .achievements-scroll::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, var(--primary-light), var(--primary-color));
        }

        #achievements-list-champ,
        #achievements-list-runner,
        #achievements-list-records,
        #achievements-list-awards,
        #manager-achievements-list-champ,
        #manager-achievements-list-runner,
        #manager-achievements-list-records {
            list-style: none;
            padding: 0;
            margin: 1rem 0 1.5rem;
        }

        #achievements-list-champ li,
        #achievements-list-runner li,
        #achievements-list-records li,
        #achievements-list-awards li,
        #manager-achievements-list-champ li,
        #manager-achievements-list-runner li,
        #manager-achievements-list-records li {
            margin: 0.7rem 0;
            font-size: 1rem;
            color: var(--text-color);
            padding: 0.7rem 1rem;
            background-color: var(--secondary-color);
            border-radius: 6px;
            transition: all var(--transition-speed) ease;
            display: flex;
            align-items: center;
        }

        #achievements-list-champ li:hover,
        #manager-achievements-list-champ li:hover {
            background-color: var(--highlight-champion);
        }

        #achievements-list-runner li:hover,
        #manager-achievements-list-runner li:hover {
            background-color: var(--highlight-runnerup);
        }

        #achievements-list-records li:hover,
        #manager-achievements-list-records li:hover {
            background-color: rgba(255, 215, 0, 0.1);
        }

        #achievements-list-awards li:hover {
            background-color: rgba(75, 0, 130, 0.1);
        }

        #achievements-list-champ li::before,
        #manager-achievements-list-champ li::before {
            content: '\f091';
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
            font-size: 0.9rem;
            margin-right: 0.7rem;
            color: var(--accent-color);
        }

        #achievements-list-runner li::before,
        #manager-achievements-list-runner li::before {
            content: '\f5a2';
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
            font-size: 0.9rem;
            margin-right: 0.7rem;
            color: var(--primary-color);
        }

        #achievements-list-records li::before,
        #manager-achievements-list-records li::before {
            content: '\f02e';
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
            font-size: 0.9rem;
            margin-right: 0.7rem;
            color: #ff9800;
        }

        #achievements-list-awards li::before {
            content: '\f005';
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
            font-size: 0.9rem;
            margin-right: 0.7rem;
            color: #6a0dad;
        }

        .record-shared-note {
            font-size: 0.8rem;
            color: var(--text-secondary);
            font-style: italic;
            margin-top: 0.5rem;
            padding-left: 1.7rem;
        }

        .modal-content h2 {
            color: var(--primary-color);
            margin-bottom: 1.5rem;
            border-bottom: 2px solid var(--accent-color);
            padding-bottom: 0.8rem;
        }

        .modal-content h3 {
            color: var(--primary-color);
            margin-top: 1.5rem;
            margin-bottom: 1rem;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
        }

        .modal-content h3::before {
            margin-right: 0.7rem;
            font-family: 'Font Awesome 6 Free';
            font-weight: 900;
        }

        #team-trophies-count::before,
        #manager-trophies-count::before {
            content: '\f091';
            color: var(--accent-color);
        }

        #team-runnerups-count::before,
        #manager-runnerups-count::before {
            content: '\f5a2';
            color: var(--primary-color);
        }

        #team-records-count::before,
        #manager-records-count::before {
            content: '\f02e';
            color: #ff9800;
        }

        #team-awards-count::before {
            content: '\f005';
            color: #6a0dad;
        }

        .back-to-top {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            background: linear-gradient(135deg, var(--primary-color), var(--primary-light));
            color: var(--light-text);
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            transition: all var(--transition-speed) ease;
            z-index: 50;
            opacity: 0;
            transform: translateY(20px);
        }

        .back-to-top.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .back-to-top:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .hidden {
            display: none;
        }

        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(44, 62, 80, 0.4);
            }
            70% {
                box-shadow: 0 0 0 10px rgba(44, 62, 80, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(44, 62, 80, 0);
            }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        .season-table {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .season-table.active {
            display: block;
        }

        .season-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.5rem;
            margin-top: 1rem;
        }

        @media (max-width: 991px) {
            .season-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .season-grid {
                grid-template-columns: 1fr;
            }
        }

        .competition-card {
            background: var(--surface-color);
            border-radius: 8px;
            padding: 1rem;
            box-shadow: var(--card-shadow);
            border-left: 4px solid var(--primary-color);
        }

        .competition-card h4 {
            color: var(--primary-color);
            margin-bottom: 0.5rem;
            font-size: 1rem;
        }

        .competition-card h4 a {
            color: var(--primary-color);
            text-decoration: none;
            transition: color var(--transition-speed) ease;
        }

        .competition-card h4 a:hover {
            color: var(--accent-color);
        }

        .competition-card p {
            font-size: 0.9rem;
            margin: 0.3rem 0;
            color: var(--text-color);
        }

        .comparison-container {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            align-items: center;
            position: relative;
        }

        .comparison-input {
            flex: 1;
            padding: 0.8rem;
            font-size: 1rem;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            outline: none;
            transition: all var(--transition-speed) ease;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
            background-color: var(--surface-color);
            color: var(--text-color);
        }

        .comparison-input:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(44, 62, 80, 0.1);
        }

        .vs-text {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--primary-color);
            margin: 0 0.5rem;
        }

        .comparison-results {
            display: none;
            animation: slideIn 0.5s ease forwards;
        }

        .comparison-results.visible {
            display: block;
        }

        .comparison-bar-container {
            margin: 1rem 0;
            background-color: var(--secondary-color);
            border-radius: 8px;
            padding: 0.8rem;
            box-shadow: var(--card-shadow);
        }

        .comparison-bar-title {
            font-size: 1rem;
            font-weight: 500;
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }

        .comparison-bar {
            height: 20px;
            width: 100%;
            background: linear-gradient(90deg, var(--accent-color) 0%, var(--accent-hover) 50%, var(--primary-light) 50%, var(--primary-color) 100%);
            border-radius: 10px;
            overflow: hidden;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .comparison-legend {
            display: flex;
            justify-content: space-between;
            margin-top: 0.5rem;
            font-size: 0.9rem;
            color: var(--text-color);
        }

        .comparison-legend span {
            display: flex;
            align-items: center;
        }

        .comparison-legend span::before {
            content: '';
            width: 12px;
            height: 12px;
            display: inline-block;
            margin-right: 0.5rem;
            border-radius: 50%;
        }

        .comparison-legend .entity1::before {
            background-color: var(--accent-color);
        }

        .comparison-legend .entity2::before {
            background-color: var(--primary-light);
        }

        .more-details {
            cursor: pointer;
            color: var(--accent-color);
            font-size: 0.9rem;
            margin-top: 0.5rem;
            display: inline-block;
            transition: all var(--transition-speed) ease;
        }

        .more-details:hover {
            color: var(--accent-hover);
            text-decoration: underline;
        }

        .detailed-comparison {
            display: none;
            margin-top: 1rem;
            padding: 1rem;
            background-color: var(--surface-color);
            border-radius: 8px;
            box-shadow: var(--card-shadow);
        }

        .detailed-comparison.visible {
            display: block;
        }

        .detailed-comparison table {
            width: 100%;
            border-collapse: collapse;
        }

        .detailed-comparison th,
        .detailed-comparison td {
            padding: 0.5rem;
            text-align: center;
            border: 1px solid var(--border-color);
        }

        .detailed-comparison th {
            background-color: var(--primary-color);
            color: var(--light-text);
        }

        .detailed-comparison td {
            background-color: var(--secondary-color);
        }

        .cam-highlight,
        .sub-highlight {
            font-weight: bold;
        }

        .season-input-container {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .season-input-container input {
            width: 50px;
            padding: 0.5rem;
            font-size: 0.9rem;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            text-align: center;
            background-color: var(--surface-color);
            color: var(--text-color);
        }

        .season-input-container button {
            padding: 0.5rem 1rem;
            font-size: 0.9rem;
        }

        .slideshow-controls {
            display: flex;
            align-items: center;
            gap: 1rem;
            flex-wrap: nowrap;
        }

        .tabs {
            display: flex;
            margin-bottom: 1rem;
        }

        .tab-button {
            flex: 1;
            padding: 0.5rem;
            border: none;
            background-color: var(--secondary-color);
            color: var(--primary-color);
            cursor: pointer;
            transition: all var(--transition-speed) ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .tab-button.active {
            background-color: var(--primary-color);
            color: var(--light-text);
        }

        .evolution-container {
            margin-top: 1.5rem;
            padding: 1.5rem;
            background-color: var(--surface-color);
            border-radius: 10px;
            box-shadow: var(--card-shadow);
            transition: all var(--transition-speed) ease;
        }

        .evolution-controls {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            align-items: center;
        }

        .evolution-speed-controls {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .speed-btn {
            padding: 0.5rem 1rem;
            border: 1px solid var(--border-color);
            background-color: var(--surface-color);
            color: var(--text-color);
            border-radius: 6px;
            cursor: pointer;
            transition: all var(--transition-speed) ease;
        }

        .speed-btn.active {
            background-color: var(--accent-color);
            color: white;
            border-color: var(--accent-color);
        }

        .edition-indicator {
            font-size: 1rem;
            font-weight: 600;
            color: var(--accent-color);
            margin-left: auto;
            background-color: var(--secondary-color);
            padding: 0.5rem 1rem;
            border-radius: 6px;
        }

        canvas {
            max-width: 100%;
            height: auto;
        }

        .competition-icon {
            width: 24px;
            height: 24px;
            margin-right: 0.7rem;
            vertical-align: middle;
            border-radius: 4px;
        }

        footer {
            background-color: var(--surface-color);
            border-top: 1px solid var(--border-color);
            padding: 2rem;
            margin-top: 3rem;
            text-align: center;
        }

        .footer-links {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .footer-link {
            color: var(--primary-color);
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: color var(--transition-speed) ease;
            font-size: 1rem;
        }

        .footer-link:hover {
            color: var(--accent-color);
        }

        .footer-note {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-top: 1rem;
        }

        .edition-note {
            font-size: 0.9em;
            opacity: 0.8;
            margin-left: 2px;
        }

        .evolution-timeline {
            flex: 1;
            margin: 0 1rem;
        }

        .timeline-slider {
            width: 100%;
            height: 6px;
            -webkit-appearance: none;
            appearance: none;
            background: linear-gradient(90deg, var(--primary-color) 0%, var(--primary-light) 100%);
            border-radius: 3px;
            outline: none;
            opacity: 0.8;
            transition: opacity var(--transition-speed) ease;
        }

        .timeline-slider:hover {
            opacity: 1;
        }

        .timeline-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: var(--accent-color);
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            transition: all var(--transition-speed) ease;
        }

        .timeline-slider::-webkit-slider-thumb:hover {
            background: var(--accent-hover);
            transform: scale(1.1);
        }

        .timeline-slider::-moz-range-thumb {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: var(--accent-color);
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            border: none;
            transition: all var(--transition-speed) ease;
        }

        .timeline-slider::-moz-range-thumb:hover {
            background: var(--accent-hover);
            transform: scale(1.1);
        }

        .ranking-list-item {
            display: flex;
            align-items: center;
            padding: 0.8rem;
            border-bottom: 1px solid var(--border-color);
            transition: background-color var(--transition-speed) ease;
        }

        .ranking-list-item:hover {
            background-color: rgba(66, 153, 225, 0.1);
        }

        .ranking-position {
            font-weight: bold;
            font-size: 1.1rem;
            color: var(--primary-color);
            width: 40px;
            text-align: center;
            margin-right: 1rem;
        }

        .ranking-name {
            flex: 1;
            font-size: 1rem;
            color: var(--text-color);
        }

        .ranking-trophies {
            font-weight: bold;
            color: var(--accent-color);
            background-color: var(--secondary-color);
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.9rem;
        }

        .ranking-note {
            margin-bottom: 1rem;
            padding: 0.8rem;
            background-color: var(--secondary-color);
            border-radius: 6px;
            color: var(--text-secondary);
            font-size: 0.9rem;
            text-align: center;
            border-left: 3px solid var(--accent-color);
        }

        .footer-more-data {
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid var(--border-color);
        }

        .footer-more-data-title {
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 0.8rem;
            font-size: 1rem;
        }

        .footer-more-data-links {
            display: flex;
            justify-content: center;
            gap: 2rem;
            flex-wrap: wrap;
        }

        .footer-more-data-link {
            color: var(--text-secondary);
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: color var(--transition-speed) ease;
            font-size: 0.9rem;
        }

        .footer-more-data-link:hover {
            color: var(--accent-color);
        }

        @media (max-width: 1200px) {
            .menu-content {
                width: 90vw;
                max-width: 1000px;
            }
            .menu-section.senior ul {
                column-count: 3;
            }
        }

        @media (max-width: 991px) {
            .cards-container {
                grid-template-columns: repeat(2, 1fr);
            }
            .header-content {
                flex-wrap: wrap;
                justify-content: center;
            }
            .search-container {
                width: 100%;
                margin-top: 1rem;
            }
            .menu-content {
                flex-direction: column;
                max-height: 70vh;
                overflow-y: auto;
            }
            .menu-section {
                width: 100% !important;
                margin-bottom: 1.5rem;
            }
            .menu-section.senior ul {
                column-count: 2;
            }
            .footer-links {
                flex-direction: column;
                gap: 1rem;
            }
            .footer-more-data-links {
                flex-direction: column;
                gap: 1rem;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }
            .cards-container {
                grid-template-columns: 1fr;
            }
            .rankings-container {
                grid-template-columns: 1fr;
            }
            .header-content {
                padding: 0 1rem;
            }
            .slideshow-controls {
                display: flex;
                align-items: center;
                gap: 1rem;
            }
            .comparison-container {
                flex-direction: column;
                gap: 0.5rem;
            }
            .comparison-input {
                width: 100%;
            }
            .slideshow-controls {
                display: flex;
                align-items: center;
                gap: 0.5rem;
                flex-wrap: nowrap;
            }
            .evolution-controls {
                flex-direction: column;
                align-items: stretch;
            }
            .evolution-timeline {
                margin: 0.5rem 0;
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="header-content">
            <div class="menu">
                <div class="menu-trigger" onclick="toggleMenu()">
                    <span><i class="fas fa-trophy"></i> Competiciones</span>
                    <i class="fas fa-chevron-down"></i>
                </div>
                <div id="menu-content" class="menu-content">
                    <div class="menu-section senior">
                        <h3>Competiciones de clubes</h3>
                        <ul id="senior-competitions"></ul>
                    </div>
                    <div class="menu-section national">
                        <h3>Competiciones de selecciones</h3>
                        <ul id="national-competitions"></ul>
                    </div>
                    <div class="menu-section filial">
                        <h3>Más competiciones</h3>
                        <ul id="filial-competitions"></ul>
                    </div>
                </div>
            </div>
            
            <h1 onclick="location.reload()">Palmarés de TSM</h1>
            
            <div style="display: flex; align-items: center;">
                <div class="search-container">
                    <button title="Listas" id="teams-button" class="btn" onclick="openTeamsModal()">
                        <i class="fas fa-futbol"></i>
                    </button>
                    <input type="text" id="search-input" class="search-input" placeholder="Buscar" />
                    <ul id="suggestions" class="suggestions"></ul>
                </div>
                <button class="dark-mode-toggle" id="dark-mode-toggle" title="Alternar modo oscuro">
                    <i class="fas fa-moon"></i>
                </button>
            </div>
        </div>
    </header>
    
    <div class="container">
        <div class="cards-container" id="cards-container">
            <div class="card">
                <h3>Mánager más laureado</h3>
                <img alt="Icono Mánager" src="https://2img.net/i.imgur.com/0DnIEJu.png" />
                <p>
                    <span onclick="showManagerAchievements('VictorPro')" class="clickable">VictorPro</span>
                </p>
                <i class="fas fa-medal star"></i>
            </div>
            
            <div class="card">
                <h3>Club más laureado</h3>
                <img alt="Icono Club" src="https://2img.net/i.imgur.com/Kz20esO.png" />
                <p>
                    <span onclick="showTeamAchievements('Bayern de Múnich')" class="clickable">Bayern de Múnich</span>
                </p>
                <i class="fas fa-trophy star"></i>
            </div>
            
            <div class="card">
                <h3>Selección más laureada</h3>
                <img alt="Icono Selección" src="https://2img.net/i.imgur.com/pA7xodV.png" />
                <p>
                    <span onclick="showTeamAchievements('Argentina')" class="clickable">Argentina</span>
                </p>
                <i class="fas fa-globe star"></i>
            </div>
        </div>
        
        <div class="competition" id="temporadas-section">
            <div class="competition-header">
                <span>Temporada a temporada</span>
                <div class="slideshow-controls">
                    <div class="season-input-container">
                        <input placeholder="T" min="1" id="season-input" type="number" onkeydown="if(event.key === 'Enter') goToSeason()" />
                        <button class="btn" onclick="goToSeason()">Ir</button>
                    </div>
                    <button class="btn" onclick="previousSeason()">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <span id="current-season">T1</span>
                    <button class="btn" onclick="nextSeason()">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </div>
            <div class="competition-body" id="seasons-container"></div>
        </div>
        
        <div class="competition" id="comparison-section">
            <div class="competition-header">
                <span>Comparar equipos/mánagers</span>
            </div>
            <div class="competition-body">
                <div class="comparison-container">
                    <div class="search-container">
                        <input placeholder="Equipo o Mánager 1" class="comparison-input" id="entity1" type="text" />
                        <ul id="entity1-suggestions" class="suggestions"></ul>
                    </div>
                    <span class="vs-text">vs</span>
                    <div class="search-container">
                        <input placeholder="Equipo o Mánager 2" class="comparison-input" id="entity2" type="text" />
                        <ul id="entity2-suggestions" class="suggestions"></ul>
                    </div>
                    <button class="btn" onclick="compareEntities()">Comparar</button>
                    <button class="btn random" onclick="randomCompare()">Aleatorio</button>
                    <button class="btn purple" onclick="resetComparison()">Reiniciar</button>
                </div>
                <div class="comparison-results" id="comparison-results"></div>
            </div>
        </div>
        
        <div id="competitions-container"></div>
    </div>
    
    <footer>
        <div class="footer-links">
            <a href="#" class="footer-link" onclick="showSeasonsModal(); return false;">
                <i class="fas fa-calendar-alt"></i>
                <span>¿Cuándo se disputó cada temporada?</span>
            </a>
            <a href="#" class="footer-link" onclick="showTeamOfYearModal(); return false;">
                <i class="fas fa-star"></i>
                <span>Equipo del año TSM</span>
            </a>
            <a href="#" class="footer-link" onclick="showRankingModal(); return false;">
                <i class="fas fa-trophy"></i>
                <span>Ranking</span>
            </a>
        </div>
        <div class="footer-note">
            Esta página sólo muestra el palmarés de competiciones oficiales. Los torneos amistosos no están incluidos.
        </div>
        
        <div class="footer-more-data">
            <div class="footer-more-data-title">Más datos</div>
            <div class="footer-more-data-links">
                <a href="https://www.tusoccermanager.com/h89-playersearch-html" target="_blank" class="footer-more-data-link">
                    <i class="fas fa-search"></i>
                    <span>Buscador de jugadores</span>
                </a>
                <a href="https://alantsm.github.io/datacentre/" target="_blank" class="footer-more-data-link">
                    <i class="fas fa-database"></i>
                    <span>Central de datos y estadísticas</span>
                </a>
                <a href="https://www.tusoccermanager.com/h114-headtohead-html" target="_blank" class="footer-more-data-link">
                    <i class="fas fa-people-arrows"></i>
                    <span>Historial de enfrentamientos</span>
                </a>
            </div>
        </div>
    </footer>
    
    <div id="team-achievements-modal" class="modal">
        <div class="modal-content">
            <button title="Ir a las listas" onclick="openTeamsModal()" style="position: absolute; left: 1rem; top: 1rem; background: none; border: none; color: var(--accent-color); font-size: 1.5rem; cursor: pointer;">
                <i class="fas fa-arrow-left"></i>
            </button>
            <button class="copy-achievements" onclick="copyAchievements('team')" title="Copiar logros al portapapeles">
                <i class="fas fa-copy"></i>
            </button>
            <span class="close fas fa-times" onclick="closeModal('team-achievements-modal')"></span>
            <h2 id="modal-team-name"></h2>
            <div class="achievements-scroll">
                <h3 id="team-trophies-count">Trofeos</h3>
                <ul id="achievements-list-champ"></ul>
                <h3 id="team-runnerups-count">Subcampeonatos</h3>
                <ul id="achievements-list-runner"></ul>
                <h3 id="team-records-count">Récords</h3>
                <ul id="achievements-list-records"></ul>
                <h3 id="team-awards-count">Premios</h3>
                <ul id="achievements-list-awards"></ul>
                <div id="team-record-shared-note" class="record-shared-note"></div>
            </div>
        </div>
    </div>
    
    <div id="manager-achievements-modal" class="modal">
        <div class="modal-content">
            <button title="Ir a las listas" onclick="openTeamsModal()" style="position: absolute; left: 1rem; top: 1rem; background: none; border: none; color: var(--accent-color); font-size: 1.5rem; cursor: pointer;">
                <i class="fas fa-arrow-left"></i>
            </button>
            <button class="copy-achievements" onclick="copyAchievements('manager')" title="Copiar logros al portapapeles">
                <i class="fas fa-copy"></i>
            </button>
            <span class="close fas fa-times" onclick="closeModal('manager-achievements-modal')"></span>
            <h2 id="modal-manager-name"></h2>
            <div class="achievements-scroll">
                <h3 id="manager-trophies-count">Trofeos</h3>
                <ul id="manager-achievements-list-champ"></ul>
                <h3 id="manager-runnerups-count">Subcampeonatos</h3>
                <ul id="manager-achievements-list-runner"></ul>
                <h3 id="manager-records-count">Récords</h3>
                <ul id="manager-achievements-list-records"></ul>
                <div id="manager-record-shared-note" class="record-shared-note"></div>
            </div>
        </div>
    </div>
    
    <div id="teams-modal" class="modal">
        <div class="modal-content">
            <span class="close fas fa-times" onclick="closeModal('teams-modal')"></span>
            <div class="tabs">
                <button onclick="showTab('clubs')" class="tab-button active">
                    <i class="fas fa-futbol"></i>
                    <span>Lista de clubes</span>
                </button>
                <button onclick="showTab('managers')" class="tab-button">
                    <i class="fas fa-user-tie"></i>
                    <span>Lista de mánagers</span>
                </button>
                <button onclick="showTab('selections')" class="tab-button">
                    <i class="fas fa-globe"></i>
                    <span>Lista de selecciones</span>
                </button>
            </div>
            <input type="text" id="entities-search" class="search-input" placeholder="Buscar entre X clubes..." oninput="filterEntities()" />
            <ul id="entities-list" class="teams-list"></ul>
        </div>
    </div>
    
    <div id="seasons-modal" class="modal">
        <div class="modal-content">
            <span class="close fas fa-times" onclick="closeModal('seasons-modal')"></span>
            <h2><i class="fas fa-calendar-alt"></i> Período de cada temporada</h2>
            <div class="modal-body">
                <div id="seasons-list" class="achievements-scroll"></div>
            </div>
        </div>
    </div>
    
    <div id="team-of-year-modal" class="modal">
        <div class="modal-content">
            <span class="close fas fa-times" onclick="closeModal('team-of-year-modal')"></span>
            <h2><i class="fas fa-star"></i> Equipo del año TSM</h2>
            <div class="modal-body">
                <div id="team-of-year-list" class="achievements-scroll"></div>
            </div>
        </div>
    </div>
    
    <div id="ranking-modal" class="modal">
        <div class="modal-content">
            <span class="close fas fa-times" onclick="closeModal('ranking-modal')"></span>
            <h2><i class="fas fa-trophy"></i> Ranking</h2>
            <div class="ranking-note">
                <i class="fas fa-info-circle"></i> Las competiciones de filiales y femeninas no se incluyen en los rankings.
            </div>
            <div class="tabs">
                <button onclick="showRankingTab('clubs')" class="tab-button active">
                    <i class="fas fa-futbol"></i>
                    <span>Clubes</span>
                </button>
                <button onclick="showRankingTab('managers')" class="tab-button">
                    <i class="fas fa-user-tie"></i>
                    <span>Mánagers</span>
                </button>
                <button onclick="showRankingTab('selections')" class="tab-button">
                    <i class="fas fa-globe"></i>
                    <span>Selecciones</span>
                </button>
            </div>
            <input type="text" id="ranking-search" class="search-input" placeholder="Buscar en el ranking..." oninput="filterRanking()" />
            <div id="ranking-list" class="teams-list"></div>
        </div>
    </div>
    
    <button onclick="scrollToTop()" class="back-to-top" id="back-to-top">
        <i class="fas fa-arrow-up"></i>
    </button>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.min.js"></script>
    <script>
        // ARRAY DE COMPETICIONES - ORDEN MODIFICADO
        const competitions = [
            // Clubes Senior (0-40) - 41 competiciones
            { id: "champions-league", name: "Champions League" },
            { id: "conference-league", name: "Conference League" },
            { id: "copa-1ª", name: "Copa 1ª" },
            { id: "copa-2ª", name: "Copa 2ª" },
            { id: "copa-alemana", name: "Copa alemana" },
            { id: "copa-continental-sudamericana", name: "Copa continental sudamericana" },
            { id: "copa-española", name: "Copa española" },
            { id: "copa-francesa", name: "Copa francesa" },
            { id: "copa-inglesa", name: "Copa inglesa" },
            { id: "copa-italiana", name: "Copa italiana" },
            { id: "copa-libertadores", name: "Copa libertadores" },
            { id: "copa-norteamericana", name: "Copa norteamericana" },
            { id: "copa-de-resto-de-europa", name: "Copa de resto de Europa" },
            { id: "copa-de-resto-de-europa-oriental", name: "Copa de resto de Europa oriental" },
            { id: "copa-sudamericana", name: "Copa sudamericana" },
            { id: "copa-total", name: "Copa Total" },
            { id: "copa-tsm", name: "Copa TSM" },
            { id: "europa-league", name: "Europa League" },
            { id: "liga-1ª", name: "Liga 1ª" },
            { id: "liga-2ª", name: "Liga 2ª" },
            { id: "liga-alemana", name: "Liga alemana" },
            { id: "liga-española", name: "Liga española" },
            { id: "liga-francesa", name: "Liga francesa" },
            { id: "liga-inglesa", name: "Liga inglesa" },
            { id: "liga-italiana", name: "Liga italiana" },
            { id: "liga-norteamericana", name: "Liga norteamericana" },
            { id: "liga-de-resto-de-europa", name: "Liga de resto de Europa" },
            { id: "liga-de-resto-de-europa-oriental", name: "Liga de resto de Europa oriental" },
            { id: "liga-sudamericana", name: "Liga sudamericana" },
            { id: "mundialito-de-clubes", name: "Mundialito de clubes" },
            { id: "recopa-de-europa", name: "Recopa de Europa" },
            { id: "supercopa-1ª", name: "Supercopa 1ª" },
            { id: "supercopa-2ª", name: "Supercopa 2ª" },
            { id: "supercopa-de-alemania", name: "Supercopa de Alemania" },
            { id: "supercopa-de-españa", name: "Supercopa de España" },
            { id: "supercopa-de-europa", name: "Supercopa de Europa" },
            { id: "supercopa-de-francia", name: "Supercopa de Francia" },
            { id: "supercopa-de-inglaterra", name: "Supercopa de Inglaterra" },
            { id: "supercopa-de-italia", name: "Supercopa de Italia" },
            { id: "supercopa-de-resto-de-europa", name: "Supercopa de resto de Europa" },
            { id: "supercopa-de-sudamérica", name: "Supercopa de Sudamérica" },
            { id: "supercopa-de-resto-de-europa-oriental", name: "Supercopa de resto de Europa oriental" },
            
            // Selecciones Nacionales (41-48) - 8 competiciones
            { id: "copa-américa", name: "Copa América" },
            { id: "copa-áfrica", name: "Copa África" },
            { id: "copa-asia-oceanía", name: "Copa Asia-Oceanía" },
            { id: "copa-confederaciones", name: "Copa Confederaciones" },
            { id: "eurocopa", name: "Eurocopa" },
            { id: "mundial", name: "Mundial" },
            { id: "nations-league", name: "Nations League" },
            
            // Más competiciones (49-60) - 12 competiciones (Eurocopa femenina + filiales)
            { id: "eurocopa-femenina", name: "Eurocopa femenina" },
            { id: "1ªsub-2123", name: "1ª Sub 21/23" },
            { id: "2ª-sub-21/23", name: "2ª Sub 21/23" },
            { id: "copa-tsm-sub-21/23", name: "Copa TSM Sub 21/23" },
            { id: "liga-alemana-de-filiales", name: "Liga alemana de filiales" },
            { id: "liga-española-de-filiales", name: "Liga española de filiales" },
            { id: "liga-francesa-de-filiales", name: "Liga francesa de filiales" },
            { id: "liga-inglesa-de-filiales", name: "Liga inglesa de filiales" },
            { id: "liga-italiana-de-filiales", name: "Liga italiana de filiales" },
            { id: "liga-norteamericana-de-filiales", name: "Liga norteamericana de filiales" },
            { id: "liga-de-resto-de-europa-de-filiales", name: "Liga de resto de Europa de filiales" },
            { id: "liga-sudamericana-de-filiales", name: "Liga sudamericana de filiales" },
            { id: "youth-league", name: "Youth League" }
        ];

        const fuseOptions = {
            keys: ['name'],
            threshold: 0.3,
        };
        const fuse = new Fuse(competitions, fuseOptions);

        let selectedSuggestionIndex = -1;
        let shieldsMap = {};
        let competitionShieldsMap = {};

        const allTeams = [
            "Bayer Leverkusen", "Bayern de Múnich", "Borussia Dortmund", "Borussia Mönchengladbach", "Colonia", "Eintracht Frankfurt", "Friburgo", "Hamburgo", "Hannover 96", "Hoffenheim", "RB Leipzig", "Núremberg", "Schalke 04", "Stuttgart", "Werder Bremen", "Wolfsburgo", "Boca Juniors", "Estudiantes de La Plata", "River Plate", "RB Salzburgo", "Anderlecht", "Internacional", "Santos", "São Paulo", "Toronto", "Colo-Colo", "Once Caldas", "Copenhague", "Liga de Quito", "Celtic", "Rangers", "Athletic Club", "Atlético de Madrid", "Barcelona", "Deportivo de la Coruña", "Espanyol", "Getafe", "Levante", "Málaga", "Mallorca", "Osasuna", "Real Madrid", "Real Sociedad", "Sevilla", "Valencia", "Villarreal", "Colorado Rapids", "DC United", "Los Angeles Galaxy", "New England Revolution", "New York Red Bulls", "Auxerre", "Évian", "Girondins de Burdeos", "Lille", "Mónaco", "Montpellier", "Nancy", "Olympique de Lyon", "Olympique de Marsella", "PSG", "Saint-Étienne", "Sochaux", "Stade Rennes", "Toulouse", "Valenciennes", "Olympiakos", "Panathinaikos", "Arsenal", "Aston Villa", "Chelsea", "Everton", "Fulham", "Leicester City", "Liverpool", "Manchester City", "Manchester United", "Newcastle United", "Norwich City", "Southampton", "Stoke City", "Sunderland", "Swansea City", "Tottenham Hotspur", "West Bromwich Albion", "Atalanta", "Bolonia", "Catania", "Chievo de Verona", "Fiorentina", "Génova", "Inter de Milán", "Juventus", "Lazio", "Milan", "Nápoles", "Palermo", "Parma", "Roma", "Sampdoria", "Udinese", "Club América", "Atlas", "Cruz Azul", "Monterrey", "Pachuca", "Tigres", "Ajax", "AZ", "Feyenoord", "PSV", "Twente", "Benfica", "Oporto", "Sporting de Lisboa", "Braga", "Anzhí Majachkalá", "CSKA de Moscú", "Rubin Kazan", "Spartk de Moscú", "Zenit", "Basilea", "Galatasaray", "Fenerbahçe", "Dínamo de Kiev", "Shakhtar Donetsk", "Nacional", "Peñarol", "Caracas"
        ].sort((a, b) => a.localeCompare(b));

        const allManagers = [
            "1fantasma1", ".tinchobolso", "Aaron García", "Abian09", "abrodex", "adrimigage", "aguenteboca", "Alan", "ale7", "ale7", "Alexfernando", "alexmurcia", "AlexisUsle", "Alguero", "alvarocesc48", "AlxaN", "ansen17", "ari", "Arseneger", "atlas", "Benz9", "Benzema11", "Big Master", "bjavi9", "bkn", "Borjibiris35", "botiboti", "canna", "carie86", "cblanco10", "catacrack", "champ_8", "char10", "chelito", "Christian Ziege", "Connor", "Danko", "Davidfer03", "diegoc", "dlv0507", "Edu4", "El-chachi", "ellocogrande", "eltpm20", "Fabio2907", "Fabrizio", "facudobbo", "FalconXVI", "Fede!", "ficanoCR9", "Fran_28", "franvilla7", "Geminis20", "George1", "goose", "grg150", "ignacio", "ilmister", "Ivan_CARP", "Jaii28", "James Wales", "Javier_C.", "javier293", "Javier García", "javihazard17", "Joak", "Juanca", "juancho233", "juanje99", "jvdo2001", "Kyon_Hirasawa", "LaloH93", "lucas_93", "lucfranz", "LugaP", "Marcosrc", "Math", "Matias33", "Maximanya10", "Maxi Signorelli", "mephisto9", "Messinho", "mikel19", "MinoRaiola", "Mister Fierro", "MisterRJ", "nanocaveda", "Neo150", "nicolasreye3", "osk_vlc", "osval99", "OttoMou", "Pablinho18", "Petrer", "pinturicchio", "primo98", "Ramiro12", "roberto.martinez", "Rodo", "rojo", "S13P", "sebas9406", "sghjeds", "snow13", "SonK", "Super Duncan", "sting", "Stm46", "sudordecamacho", "Tavlaridis", "The_Effect_2000", "VictorPro", "Tinguili-CR7", "Tomer Hemed", "traifor", "Trafalgar", "valmi69", "VictorTigrero", "Villa36", "Xx_AdRiAn_xX", "yair_rafael", "zizou", "KevinAnthony", "veldrane7", "Vinalar", "DiegoTristón", "jesuscr7", "Roger", "chulesama", "fabioFS", "Tommy18S", "Luiche", "Imanol", "Tinchoenano", "Paisano24"
        ].map(name => name.replace(/[@"]/g, '')).sort((a, b) => a.localeCompare(b));

        const allSelections = [
            "Argelia", "Camerún", "Costa de Marfil", "Egipto", "Ghana", "Marruecos", "Nigeria", "Senegal", "Sudáfrica", "Túnez", "Arabia Saudita", "Australia", "China", "Emiratos Árabes Unidos", "Corea del Norte", "Corea del Sur", "Irán", "Japón", "Qatar", "Alemania", "Bélgica", "Bosnia y Herzegovina", "Croacia", "Dinamarca", "Eslovaquia", "Eslovenia", "España", "Francia", "Grecia", "Inglaterra", "Islandia", "Israel", "Italia", "Noruega", "Países Bajos", "Polonia", "Portugal", "República Checa", "República de Irlanda", "Rusia", "Serbia", "Suecia", "Suiza", "Turquía", "Ucrania", "Canadá", "Costa Rica", "Estados Unidos", "Haití", "Honduras", "Jamaica", "México", "Panamá", "Nueva Zelanda", "Argentina", "Bolivia", "Brasil", "Chile", "Colombia", "Ecuador", "Paraguay", "Perú", "Uruguay", "Venezuela"
        ].sort((a, b) => a.localeCompare(b));

        // Variables para almacenar datos de premios y ranking
        let teamOfYearData = [];
        let rankingData = {
            clubs: [],
            managers: [],
            selections: []
        };
        let currentRankingTab = 'clubs';

        async function loadShieldsDatabase() {
            try {
                const response = await fetch('https://www.tusoccermanager.com/h63-teambadgedb-html');
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                const html = await response.text();
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');
                const shieldsList = doc.querySelectorAll('#shields-list li');
                shieldsMap = {};
                competitionShieldsMap = {};
                
                shieldsList.forEach(li => {
                    const text = li.textContent.trim();
                    const separatorIndex = text.indexOf(': ');
                    if (separatorIndex === -1) return;
                    
                    const name = text.substring(0, separatorIndex).trim();
                    const url = text.substring(separatorIndex + 2).trim();
                    
                    const isCompetition = competitions.some(comp => comp.name === name);
                    
                    if (isCompetition) {
                        competitionShieldsMap[name] = url;
                    } else {
                        shieldsMap[name] = url;
                    }
                });
                
                return { shieldsMap, competitionShieldsMap };
            } catch (error) {
                console.error('Error al cargar la base de datos de escudos:', error);
                return { shieldsMap: {}, competitionShieldsMap: {} };
            }
        }

        async function loadTeamOfYearData() {
            try {
                const response = await fetch('https://www.tusoccermanager.com/h116-teamoftheyear-html');
                if (!response.ok) throw new Error('No se pudo cargar la información');
                const html = await response.text();
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');
                const preContent = doc.querySelector('pre');

                if (preContent) {
                    const lines = preContent.textContent.split('\n').filter(line => line.trim());
                    teamOfYearData = lines.map(line => {
                        const [season, team] = line.split(':').map(s => s.trim());
                        return { season: season.replace('Temporada ', ''), team };
                    });
                }
            } catch (error) {
                console.error('Error al cargar equipo del año:', error);
            }
        }

        const allSearchableItems = [
            ...competitions.map(comp => ({ type: 'competition', name: comp.name, id: comp.id })),
            ...allTeams.map(team => ({ type: 'team', name: team })),
            ...allManagers.map(manager => ({ type: 'manager', name: manager })),
            ...allSelections.map(selection => ({ type: 'selection', name: selection }))
        ];

        const fuseSearch = new Fuse(allSearchableItems, fuseOptions);

        function showSuggestions(input) {
            const suggestionsList = document.getElementById('suggestions');
            suggestionsList.innerHTML = '';
            selectedSuggestionIndex = -1;
            if (input.length > 0) {
                const results = fuseSearch.search(input);
                results.forEach((result, index) => {
                    const li = document.createElement('li');
                    li.textContent = result.item.name;
                    li.setAttribute('data-type', result.item.type);
                    li.setAttribute('data-name', result.item.name);
                    li.setAttribute('data-id', result.item.id || '');
                    li.addEventListener('click', () => {
                        handleSuggestionClick(result.item);
                        document.getElementById('search-input').value = '';
                        suggestionsList.classList.remove('visible');
                    });
                    suggestionsList.appendChild(li);
                });
                suggestionsList.classList.add('visible');
            } else {
                suggestionsList.classList.remove('visible');
            }
        }

        function handleSuggestionClick(item) {
            if (item.type === 'competition') {
                showCompetition(item.id);
            } else if (item.type === 'team' || item.type === 'selection') {
                showTeamAchievements(item.name);
            } else if (item.type === 'manager') {
                showManagerAchievements(item.name);
            }
        }

        function selectSuggestion(index) {
            const suggestions = document.querySelectorAll('#suggestions li');
            suggestions.forEach((li, i) => {
                li.classList.remove('selected');
                if (i === index) {
                    li.classList.add('selected');
                    li.scrollIntoView({ block: 'nearest' });
                }
            });
        }

        document.getElementById('search-input').addEventListener('input', (e) => {
            showSuggestions(e.target.value);
        });

        document.getElementById('search-input').addEventListener('keydown', (e) => {
            const suggestions = document.querySelectorAll('#suggestions li');
            if (e.key === 'ArrowDown') {
                e.preventDefault();
                if (selectedSuggestionIndex < suggestions.length - 1) {
                    selectedSuggestionIndex++;
                    selectSuggestion(selectedSuggestionIndex);
                }
            } else if (e.key === 'ArrowUp') {
                e.preventDefault();
                if (selectedSuggestionIndex > 0) {
                    selectedSuggestionIndex--;
                    selectSuggestion(selectedSuggestionIndex);
                }
            } else if (e.key === 'Enter') {
                if (selectedSuggestionIndex >= 0 && selectedSuggestionIndex < suggestions.length) {
                    suggestions[selectedSuggestionIndex].click();
                } else {
                    const inputValue = e.target.value.trim();
                    const exactMatch = allSearchableItems.find(item => item.name.toLowerCase() === inputValue.toLowerCase());
                    if (exactMatch) {
                        handleSuggestionClick(exactMatch);
                        e.target.value = '';
                        document.getElementById('suggestions').classList.remove('visible');
                    }
                }
            }
        });

        document.addEventListener('click', (e) => {
            if (!e.target.closest('.search-container')) {
                document.getElementById('suggestions').classList.remove('visible');
                document.getElementById('entity1-suggestions').classList.remove('visible');
                document.getElementById('entity2-suggestions').classList.remove('visible');
            }
            if (!e.target.closest('.menu')) {
                const menuContent = document.getElementById('menu-content');
                menuContent.classList.remove('active');
                document.querySelector('.menu').classList.remove('active');
            }
        });

        function showCompetition(competitionId) {
            document.querySelectorAll('.competition').forEach(comp => {
                comp.classList.add('hidden');
                comp.style.opacity = '0';
            });
            if (competitionId) {
                const selectedComp = document.getElementById(competitionId);
                if (selectedComp) {
                    selectedComp.classList.remove('hidden');
                    setTimeout(() => {
                        selectedComp.style.opacity = '1';
                    }, 10);
                }
                document.getElementById('cards-container').classList.add('hidden');
            } else {
                document.getElementById('cards-container').classList.remove('hidden');
            }
            document.getElementById('menu-content').classList.remove('active');
        }

        function createCompetitionSection(competitionId, competitionName) {
            let headerNote = '';
            if (competitionId === 'conference-league') {
                headerNote = '<small>En las tres primeras ediciones fue una competición de filiales.</small>';
            }
            return `
                <div id="${competitionId}" class="competition hidden">
                    <div class="competition-header">
                        <span>${competitionName} ${headerNote}</span>
                        <div>
                            <button onclick="invertTable('${competitionId}')" class="btn">Invertir</button>
                            <button onclick="toggleRankings('rankings-${competitionId}')" class="btn">Rankings</button>
                            <button onclick="toggleEvolution('evolution-${competitionId}')" class="btn">Evolución</button>
                        </div>
                    </div>
                    <div class="competition-body">
                        <div class="team-selector-container">
                            <div class="team-selector">
                                <select onchange="highlightTeam('${competitionId}', this.value)" id="team-select-${competitionId}">
                                    <option value="">Selecciona un equipo</option>
                                </select>
                                <select onchange="highlightManager('${competitionId}', this.value)" id="manager-select-${competitionId}">
                                    <option value="">Selecciona un mánager</option>
                                </select>
                            </div>
                            <div class="info">
                                <div>Ediciones disputadas: <span id="editions-${competitionId}"></span></div>
                                <div>Equipos campeones distintos: <span id="unique-champions-${competitionId}"></span></div>
                            </div>
                        </div>
                        <div id="table-${competitionId}-container"></div>
                        <div id="rankings-${competitionId}" class="rankings-container hidden" data-calculated="false">
                            <div class="ranking-table">
                                <h3>Clasificación por equipos</h3>
                                <table id="team-rankings-table-${competitionId}">
                                    <thead>
                                        <tr>
                                            <th>EQUIPO</th>
                                            <th>Cam</th>
                                            <th>Sub</th>
                                        </tr>
                                    </thead>
                                    <tbody id="team-rankings-${competitionId}"></tbody>
                                </table>
                            </div>
                            <div class="ranking-table">
                                <h3>Clasificación por mánagers</h3>
                                <table id="manager-rankings-table-${competitionId}">
                                    <thead>
                                        <tr>
                                            <th>MÁNAGER</th>
                                            <th>Cam</th>
                                            <th>Sub</th>
                                        </tr>
                                    </thead>
                                    <tbody id="manager-rankings-${competitionId}"></tbody>
                                </table>
                            </div>
                        </div>
                        <div id="evolution-${competitionId}" class="evolution-container hidden" data-calculated="false">
                            <div class="evolution-speed-controls">
                                <button class="speed-btn active" data-speed="1000">Lenta</button>
                                <button class="speed-btn" data-speed="500">Media</button>
                                <button class="speed-btn" data-speed="200">Rápida</button>
                                <div class="edition-indicator" id="edition-indicator-${competitionId}">Edición: 0</div>
                            </div>
                            <div class="evolution-controls">
                                <button id="play-pause-${competitionId}" onclick="togglePlayPause('${competitionId}')" class="btn"><i class="fas fa-play"></i> Play</button>
                                <div class="evolution-timeline">
                                    <input type="range" min="0" max="100" value="0" class="timeline-slider" id="timeline-${competitionId}" oninput="seekEvolution('${competitionId}', this.value)">
                                </div>
                            </div>
                            <canvas id="evolution-chart-${competitionId}"></canvas>
                        </div>
                    </div>
                </div>
            `;
        }

        function generateMenu() {
            const seniorCompetitions = competitions.slice(0, 41);
            const nationalCompetitions = competitions.slice(41, 49);
            const moreCompetitions = competitions.slice(49);

            document.getElementById('senior-competitions').innerHTML = seniorCompetitions.map(comp => `
                <li><a href="#" onclick="showCompetition('${comp.id}'); return false;"><i class="fas fa-angle-right"></i> ${comp.name}</a></li>
            `).join('');

            document.getElementById('national-competitions').innerHTML = nationalCompetitions.map(comp => `
                <li><a href="#" onclick="showCompetition('${comp.id}'); return false;"><i class="fas fa-angle-right"></i> ${comp.name}</a></li>
            `).join('');

            document.getElementById('filial-competitions').innerHTML = moreCompetitions.map(comp => `
                <li><a href="#" onclick="showCompetition('${comp.id}'); return false;"><i class="fas fa-angle-right"></i> ${comp.name}</a></li>
            `).join('');
        }

        document.addEventListener("DOMContentLoaded", async () => {
            const { shieldsMap: loadedShields, competitionShieldsMap: loadedCompetitionShields } = await loadShieldsDatabase();
            shieldsMap = loadedShields;
            competitionShieldsMap = loadedCompetitionShields;
            
            await loadTeamOfYearData();
            
            const container = document.getElementById("competitions-container");
            competitions.forEach(comp => {
                container.insertAdjacentHTML("beforeend", createCompetitionSection(comp.id, comp.name));
            });
            generateMenu();
            initSeasonView();
            initDarkMode();
        });

        async function loadCompetitionData() {
            try {
                const response = await fetch('https://alantsm.github.io/listofhonoursdb/');
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                const html = await response.text();
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');

                competitions.forEach(comp => {
                    const data = doc.querySelector(`#${comp.id}-data table`);
                    if (data) {
                        const tableContainer = document.getElementById(`table-${comp.id}-container`);
                        tableContainer.innerHTML = data.outerHTML;
                        const table = tableContainer.querySelector('table');
                        const rows = table.querySelectorAll('tbody tr');
                        
                        // Calcular equipos campeones distintos
                        const uniqueChampions = new Set();
                        
                        rows.forEach(row => {
                            const seasonCell = row.cells[0].textContent.trim();
                            const [season, edition] = seasonCell.split('(');
                            const editionClean = edition ? edition.replace(')', '') : '';
                            
                            if (edition) {
                                row.cells[0].innerHTML = `${season} (<span class="edition-note">${editionClean}</span>)`;
                            }
                            
                            const champion = row.cells[1].textContent.trim();
                            const runnerUp = row.cells[2].textContent.trim();
                            const championShield = shieldsMap[champion] || '';
                            const runnerUpShield = shieldsMap[runnerUp] || '';
                            row.cells[1].innerHTML = `<span class="team-cell"><img src="${championShield}" width="24" height="24" alt="Escudo de ${champion}" style="margin-right: 0.5rem;">${champion}</span>`;
                            row.cells[2].innerHTML = `<span class="team-cell"><img src="${runnerUpShield}" width="24" height="24" alt="Escudo de ${runnerUp}" style="margin-right: 0.5rem;">${runnerUp}</span>`;
                            row.cells[3].classList.add('manager-cell');
                            row.cells[4].classList.add('manager-cell');
                            
                            uniqueChampions.add(champion);
                        });
                        const header = table.querySelector('thead tr th:first-child');
                        if (header) {
                            header.setAttribute('title', 'Temporada (Edición)');
                        }
                        document.getElementById(`editions-${comp.id}`).textContent = rows.length;
                        document.getElementById(`unique-champions-${comp.id}`).textContent = uniqueChampions.size;
                        populateTeamSelector(comp.id);
                        populateManagerSelector(comp.id);
                    }
                });
            } catch (error) {
                console.error('Error al cargar los datos de competiciones principales:', error);
            }
        }

        async function loadYouthCompetitionData() {
            try {
                const response = await fetch('https://www.tusoccermanager.com/h62-morecompetitionslistofhonoursdb-html');
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                const html = await response.text();
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');

                const youthCompIdMap = {
                    "eurocopa-femenina": "eurocopa-femenina-data",
                    "1ªsub-2123": "1ª-sub-21/23-data",
                    "2ª-sub-21/23": "2ª-sub-21/23-data",
                    "copa-tsm-sub-21/23": "copa-tsm-sub-21/23-data",
                    "liga-alemana-de-filiales": "liga-alemana-de-filiales-data",
                    "liga-española-de-filiales": "liga-española-de-filiales-data",
                    "liga-francesa-de-filiales": "liga-francesa-de-filiales-data",
                    "liga-inglesa-de-filiales": "liga-inglesa-de-filiales-data",
                    "liga-italiana-de-filiales": "liga-italiana-de-filiales-data",
                    "liga-norteamericana-de-filiales": "liga-norteamericana-de-filiales-data",
                    "liga-de-resto-de-europa-de-filiales": "liga-de-resto-de-europa-de-filiales-data",
                    "liga-sudamericana-de-filiales": "liga-sudamericana-de-filiales-data",
                    "youth-league": "youth-league-data"
                };

                competitions.forEach(comp => {
                    const mappedId = youthCompIdMap[comp.id];
                    if (mappedId) {
                        const data = doc.querySelector(`[id="${mappedId}"] table`);
                        if (data) {
                            const tableContainer = document.getElementById(`table-${comp.id}-container`);
                            tableContainer.innerHTML = data.outerHTML;
                            const table = tableContainer.querySelector('table');
                            const rows = table.querySelectorAll('tbody tr');
                            
                            // Calcular equipos campeones distintos
                            const uniqueChampions = new Set();
                            
                            rows.forEach(row => {
                                const seasonCell = row.cells[0].textContent.trim();
                                const [season, edition] = seasonCell.split('(');
                                const editionClean = edition ? edition.replace(')', '') : '';
                                
                                if (edition) {
                                    row.cells[0].innerHTML = `${season} (<span class="edition-note">${editionClean}</span>)`;
                                }
                                
                                const champion = row.cells[1].textContent.trim();
                                const runnerUp = row.cells[2].textContent.trim();
                                const championShield = shieldsMap[champion] || '';
                                const runnerUpShield = shieldsMap[runnerUp] || '';
                                row.cells[1].innerHTML = `<span class="team-cell"><img src="${championShield}" width="24" height="24" alt="Escudo de ${champion}" style="margin-right: 0.5rem;">${champion}</span>`;
                                row.cells[2].innerHTML = `<span class="team-cell"><img src="${runnerUpShield}" width="24" height="24" alt="Escudo de ${runnerUp}" style="margin-right: 0.5rem;">${runnerUp}</span>`;
                                row.cells[3].classList.add('manager-cell');
                                row.cells[4].classList.add('manager-cell');
                                
                                uniqueChampions.add(champion);
                            });
                            const header = table.querySelector('thead tr th:first-child');
                            if (header) {
                                header.setAttribute('title', 'Temporada (Edición)');
                            }
                            document.getElementById(`editions-${comp.id}`).textContent = rows.length;
                            document.getElementById(`unique-champions-${comp.id}`).textContent = uniqueChampions.size;
                            populateTeamSelector(comp.id);
                            populateManagerSelector(comp.id);
                        }
                    }
                });
            } catch (error) {
                console.error('Error al cargar los datos de competiciones juveniles:', error);
            }
        }

        function populateTeamSelector(compId) {
            const tableContainer = document.getElementById(`table-${compId}-container`);
            const rows = tableContainer.querySelectorAll('tbody tr');
            const teams = new Set();
            rows.forEach(row => {
                const champion = row.cells[1].textContent.trim();
                const runnerUp = row.cells[2].textContent.trim();
                teams.add(champion);
                teams.add(runnerUp);
            });
            const teamsArray = Array.from(teams).sort();
            const select = document.getElementById(`team-select-${compId}`);
            select.innerHTML = '<option value="">Selecciona un equipo</option>';
            teamsArray.forEach(team => {
                const option = document.createElement('option');
                option.value = team;
                option.textContent = team;
                select.appendChild(option);
            });
        }

        function populateManagerSelector(compId) {
            const tableContainer = document.getElementById(`table-${compId}-container`);
            const rows = tableContainer.querySelectorAll('tbody tr');
            const managers = new Set();
            rows.forEach(row => {
                const managerChamp = row.cells[3].textContent.trim().replace(/[@"]/g, '');
                const managerRunnerUp = row.cells[4].textContent.trim().replace(/[@"]/g, '');
                managers.add(managerChamp);
                managers.add(managerRunnerUp);
            });
            const managersArray = Array.from(managers).sort();
            const select = document.getElementById(`manager-select-${compId}`);
            select.innerHTML = '<option value="">Selecciona un mánager</option>';
            managersArray.forEach(manager => {
                const option = document.createElement('option');
                option.value = manager;
                option.textContent = manager;
                select.appendChild(option);
            });
        }

        function highlightTeam(compId, team) {
            const tableContainer = document.getElementById(`table-${compId}-container`);
            const rows = tableContainer.querySelectorAll('tbody tr');
            rows.forEach(row => {
                row.classList.remove('highlight-champion', 'highlight-runnerup');
                if (team) {
                    const champion = row.cells[1].textContent.trim();
                    const runnerUp = row.cells[2].textContent.trim();
                    if (champion === team) row.classList.add('highlight-champion');
                    if (runnerUp === team) row.classList.add('highlight-runnerup');
                }
            });
        }

        function highlightManager(compId, manager) {
            const tableContainer = document.getElementById(`table-${compId}-container`);
            const rows = tableContainer.querySelectorAll('tbody tr');
            rows.forEach(row => {
                row.classList.remove('highlight-champion', 'highlight-runnerup');
                if (manager) {
                    const managerChamp = row.cells[3].textContent.trim().replace(/[@"]/g, '');
                    const managerRunnerUp = row.cells[4].textContent.trim().replace(/[@"]/g, '');
                    if (managerChamp === manager) row.classList.add('highlight-champion');
                    if (managerRunnerUp === manager) row.classList.add('highlight-runnerup');
                }
            });
        }

        function toggleRankings(rankingsId) {
            const rankingsElement = document.getElementById(rankingsId);
            const compId = rankingsId.replace('rankings-', '');
            if (rankingsElement.classList.contains('hidden')) {
                rankingsElement.classList.remove('hidden');
                setTimeout(() => {
                    rankingsElement.classList.add('visible');
                    rankingsElement.scrollIntoView({ behavior: 'smooth' });
                }, 10);
                if (rankingsElement.getAttribute('data-calculated') === 'false') {
                    calculateRankings(compId);
                    rankingsElement.setAttribute('data-calculated', 'true');
                }
            } else {
                rankingsElement.classList.remove('visible');
                setTimeout(() => {
                    rankingsElement.classList.add('hidden');
                }, 500);
            }
        }

        function calculateRankings(compId) {
            const tableContainerId = `table-${compId}-container`;
            const rows = document.querySelectorAll(`#${tableContainerId} table tbody tr`);
            const teamStats = {};
            const managerStats = {};
            rows.forEach(row => {
                const cells = row.cells;
                const champion = cells[1].textContent.trim();
                const runnerUp = cells[2].textContent.trim();
                const managerChamp = cells[3].textContent.trim().replace(/[@"]/g, '');
                const managerRunnerUp = cells[4].textContent.trim().replace(/[@"]/g, '');
                teamStats[champion] = teamStats[champion] || { champ: 0, runner: 0 };
                teamStats[runnerUp] = teamStats[runnerUp] || { champ: 0, runner: 0 };
                teamStats[champion].champ++;
                teamStats[runnerUp].runner++;
                managerStats[managerChamp] = managerStats[managerChamp] || { champ: 0, runner: 0 };
                managerStats[managerRunnerUp] = managerStats[managerRunnerUp] || { champ: 0, runner: 0 };
                managerStats[managerChamp].champ++;
                managerStats[managerRunnerUp].runner++;
            });
            let teamsArray = Object.entries(teamStats).map(([team, stats]) => ({ name: team, champ: stats.champ, runner: stats.runner }));
            let managersArray = Object.entries(managerStats).map(([manager, stats]) => ({ name: manager, champ: stats.champ, runner: stats.runner }));
            teamsArray.sort((a, b) => b.champ - a.champ || b.runner - a.runner);
            managersArray.sort((a, b) => b.champ - a.champ || b.runner - a.runner);
            document.getElementById(`team-rankings-${compId}`).innerHTML = teamsArray.map(team => {
                const shieldUrl = shieldsMap[team.name] || '';
                return `<tr><td class="team-cell"><img src="${shieldUrl}" width="36" height="36" alt="Escudo de ${team.name}" style="margin-right: 0.5rem;">${team.name}</td><td>${team.champ}</td><td>${team.runner}</td></tr>`;
            }).join('');
            document.getElementById(`manager-rankings-${compId}`).innerHTML = managersArray.map(manager => `<tr><td class="manager-cell">${manager.name}</td><td>${manager.champ}</td><td>${manager.runner}</td></tr>`).join('');
        }

        function invertTable(compId) {
            const tableContainer = document.getElementById(`table-${compId}-container`);
            const table = tableContainer.querySelector('table');
            const rows = table.querySelectorAll('tbody tr');
            const rowsArray = Array.from(rows);
            rowsArray.reverse();
            const tbody = table.querySelector('tbody');
            tbody.innerHTML = '';
            rowsArray.forEach(row => {
                tbody.appendChild(row);
            });
        }

        function toggleMenu() {
            const menuContent = document.getElementById('menu-content');
            const menu = document.querySelector('.menu');
            menuContent.classList.toggle('active');
            menu.classList.toggle('active');
        }

        function formatSeasons(seasons) {
            if (seasons.length === 0) return '';
            if (seasons.length === 1) return seasons[0];
            return seasons.slice(0, -1).join(', ') + ' y ' + seasons[seasons.length - 1];
        }

        function calculateRecords(entityName, type) {
            const records = [];
            const sharedRecords = [];

            competitions.forEach(comp => {
                const tableContainer = document.getElementById(`table-${comp.id}-container`);
                if (!tableContainer) return;

                const rows = tableContainer.querySelectorAll('tbody tr');
                const winnerCounts = {};

                rows.forEach(row => {
                    let winner;
                    if (type === 'team') {
                        winner = row.cells[1].textContent.trim();
                    } else if (type === 'manager') {
                        winner = row.cells[3].textContent.trim().replace(/[@"]/g, '');
                    }

                    if (winner) {
                        winnerCounts[winner] = (winnerCounts[winner] || 0) + 1;
                    }
                });

                let maxWins = 0;
                let topWinners = [];
                for (const [winner, count] of Object.entries(winnerCounts)) {
                    if (count > maxWins) {
                        maxWins = count;
                        topWinners = [winner];
                    } else if (count === maxWins) {
                        topWinners.push(winner);
                    }
                }

                if (topWinners.includes(entityName) && maxWins > 0) {
                    const isShared = topWinners.length > 1;
                    records.push({
                        competition: comp.name,
                        wins: maxWins,
                        shared: isShared
                    });

                    if (isShared) {
                        sharedRecords.push(comp.name);
                    }
                }
            });

            return { records, sharedRecords };
        }

        function showTeamAchievements(teamName) {
            const modal = document.getElementById('team-achievements-modal');
            const teamNameElement = document.getElementById('modal-team-name');
            const champList = document.getElementById('achievements-list-champ');
            const runnerList = document.getElementById('achievements-list-runner');
            const recordsList = document.getElementById('achievements-list-records');
            const awardsList = document.getElementById('achievements-list-awards');
            const sharedNote = document.getElementById('team-record-shared-note');
            const trophiesCountElement = document.getElementById('team-trophies-count');
            const runnerupsCountElement = document.getElementById('team-runnerups-count');
            const recordsCountElement = document.getElementById('team-records-count');
            const awardsCountElement = document.getElementById('team-awards-count');
            const modalContent = document.querySelector('#team-achievements-modal .modal-content');

            teamNameElement.textContent = `Logros de ${teamName}`;
            champList.innerHTML = '';
            runnerList.innerHTML = '';
            recordsList.innerHTML = '';
            awardsList.innerHTML = '';
            sharedNote.innerHTML = '';

            const existingShield = modalContent.querySelector('img');
            if (existingShield) {
                existingShield.remove();
            }

            const shieldUrl = shieldsMap[teamName];
            if (shieldUrl) {
                const shieldImg = document.createElement('img');
                shieldImg.src = shieldUrl;
                shieldImg.alt = `Escudo de ${teamName}`;
                shieldImg.style.width = '48px';
                shieldImg.style.height = '48px';
                shieldImg.style.position = 'absolute';
                shieldImg.style.top = '30px';
                shieldImg.style.right = '50px';
                modalContent.insertBefore(shieldImg, modalContent.firstChild);
            }

            const achievementsByComp = {};
            let totalTrophies = 0;
            let totalRunnerups = 0;

            competitions.forEach(comp => {
                const tableContainer = document.getElementById(`table-${comp.id}-container`);
                if (tableContainer) {
                    const rows = tableContainer.querySelectorAll('tbody tr');
                    rows.forEach(row => {
                        const season = row.cells[0].textContent.trim().split('(')[0].trim();
                        const champion = row.cells[1].textContent.trim();
                        const runnerUp = row.cells[2].textContent.trim();
                        if (champion === teamName) {
                            if (!achievementsByComp[comp.name]) {
                                achievementsByComp[comp.name] = { champ: [], runner: [] };
                            }
                            achievementsByComp[comp.name].champ.push(season);
                            totalTrophies++;
                        }
                        if (runnerUp === teamName) {
                            if (!achievementsByComp[comp.name]) {
                                achievementsByComp[comp.name] = { champ: [], runner: [] };
                            }
                            achievementsByComp[comp.name].runner.push(season);
                            totalRunnerups++;
                        }
                    });
                }
            });

            trophiesCountElement.textContent = `Trofeos (${totalTrophies})`;
            runnerupsCountElement.textContent = `Subcampeonatos (${totalRunnerups})`;

            Object.entries(achievementsByComp).forEach(([compName, { champ, runner }]) => {
                if (champ.length > 0) {
                    const champSeasons = formatSeasons(champ.sort((a, b) => parseInt(a) - parseInt(b)));
                    const li = document.createElement('li');
                    const compShield = competitionShieldsMap[compName] || 'https://2img.net/i.imgur.com/Kz20esO.png';
                    li.innerHTML = `<img src="${compShield}" class="competition-icon" alt="Icono de ${compName}"><strong>${champ.length} ${compName}</strong>: ${champSeasons}`;
                    champList.appendChild(li);
                }
                if (runner.length > 0) {
                    const runnerSeasons = formatSeasons(runner.sort((a, b) => parseInt(a) - parseInt(b)));
                    const li = document.createElement('li');
                    const compShield = competitionShieldsMap[compName] || 'https://2img.net/i.imgur.com/Kz20esO.png';
                    li.innerHTML = `<img src="${compShield}" class="competition-icon" alt="Icono de ${compName}"><strong>${runner.length} ${compName}</strong>: ${runnerSeasons}`;
                    runnerList.appendChild(li);
                }
            });

            const { records, sharedRecords } = calculateRecords(teamName, 'team');
            recordsCountElement.textContent = `Récords (${records.length})`;

            records.forEach(record => {
                const li = document.createElement('li');
                const compShield = competitionShieldsMap[record.competition] || 'https://2img.net/i.imgur.com/Kz20esO.png';
                li.innerHTML = `<img src="${compShield}" class="competition-icon" alt="Icono de ${record.competition}"><strong>${record.competition}</strong> (${record.wins} títulos)${record.shared ? '*' : ''}`;
                recordsList.appendChild(li);
            });

            // Calcular premios (Equipo del año)
            const awards = teamOfYearData.filter(award => award.team === teamName);
            awardsCountElement.textContent = `Premios (${awards.length})`;
            
            if (awards.length > 0) {
                awards.forEach(award => {
                    const li = document.createElement('li');
                    li.innerHTML = `<strong>Equipo del año TSM</strong> (Temporada ${award.season})`;
                    awardsList.appendChild(li);
                });
            } else {
                const li = document.createElement('li');
                li.textContent = 'Ninguno.';
                awardsList.appendChild(li);
            }

            if (sharedRecords.length > 0) {
                sharedNote.innerHTML = '*Récord compartido';
            }

            if (totalTrophies === 0 && totalRunnerups === 0) {
                const liChamp = document.createElement('li');
                liChamp.textContent = 'Ninguno.';
                champList.appendChild(liChamp);
                const liRunner = document.createElement('li');
                liRunner.textContent = 'Ninguno.';
                runnerList.appendChild(liRunner);
            }

            if (records.length === 0) {
                const li = document.createElement('li');
                li.textContent = 'Ninguno.';
                recordsList.appendChild(li);
            }

            modal.classList.add('visible');
        }

        function showManagerAchievements(managerName) {
            const modal = document.getElementById('manager-achievements-modal');
            const managerNameElement = document.getElementById('modal-manager-name');
            const champList = document.getElementById('manager-achievements-list-champ');
            const runnerList = document.getElementById('manager-achievements-list-runner');
            const recordsList = document.getElementById('manager-achievements-list-records');
            const sharedNote = document.getElementById('manager-record-shared-note');
            const trophiesCountElement = document.getElementById('manager-trophies-count');
            const runnerupsCountElement = document.getElementById('manager-runnerups-count');
            const recordsCountElement = document.getElementById('manager-records-count');
            managerNameElement.textContent = `Logros de ${managerName.replace(/[@"]/g, '')}`;
            champList.innerHTML = '';
            runnerList.innerHTML = '';
            recordsList.innerHTML = '';
            sharedNote.innerHTML = '';

            const achievementsByComp = {};
            let totalTrophies = 0;
            let totalRunnerups = 0;

            competitions.forEach(comp => {
                const tableContainer = document.getElementById(`table-${comp.id}-container`);
                if (tableContainer) {
                    const rows = tableContainer.querySelectorAll('tbody tr');
                    rows.forEach(row => {
                        const season = row.cells[0].textContent.trim().split('(')[0].trim();
                        const managerChamp = row.cells[3].textContent.trim().replace(/[@"]/g, '');
                        const managerRunnerUp = row.cells[4].textContent.trim().replace(/[@"]/g, '');
                        if (managerChamp === managerName.replace(/[@"]/g, '')) {
                            if (!achievementsByComp[comp.name]) {
                                achievementsByComp[comp.name] = { champ: [], runner: [] };
                            }
                            achievementsByComp[comp.name].champ.push(season);
                            totalTrophies++;
                        }
                        if (managerRunnerUp === managerName.replace(/[@"]/g, '')) {
                            if (!achievementsByComp[comp.name]) {
                                achievementsByComp[comp.name] = { champ: [], runner: [] };
                            }
                            achievementsByComp[comp.name].runner.push(season);
                            totalRunnerups++;
                        }
                    });
                }
            });

            trophiesCountElement.textContent = `Trofeos (${totalTrophies})`;
            runnerupsCountElement.textContent = `Subcampeonatos (${totalRunnerups})`;

            Object.entries(achievementsByComp).forEach(([compName, { champ, runner }]) => {
                if (champ.length > 0) {
                    const champSeasons = formatSeasons(champ.sort((a, b) => parseInt(a) - parseInt(b)));
                    const li = document.createElement('li');
                    const compShield = competitionShieldsMap[compName] || 'https://2img.net/i.imgur.com/Kz20esO.png';
                    li.innerHTML = `<img src="${compShield}" class="competition-icon" alt="Icono de ${compName}"><strong>${champ.length} ${compName}</strong>: ${champSeasons}`;
                    champList.appendChild(li);
                }
                if (runner.length > 0) {
                    const runnerSeasons = formatSeasons(runner.sort((a, b) => parseInt(a) - parseInt(b)));
                    const li = document.createElement('li');
                    const compShield = competitionShieldsMap[compName] || 'https://2img.net/i.imgur.com/Kz20esO.png';
                    li.innerHTML = `<img src="${compShield}" class="competition-icon" alt="Icono de ${compName}"><strong>${runner.length} ${compName}</strong>: ${runnerSeasons}`;
                    runnerList.appendChild(li);
                }
            });

            const { records, sharedRecords } = calculateRecords(managerName.replace(/[@"]/g, ''), 'manager');
            recordsCountElement.textContent = `Récords (${records.length})`;

            records.forEach(record => {
                const li = document.createElement('li');
                const compShield = competitionShieldsMap[record.competition] || 'https://2img.net/i.imgur.com/Kz20esO.png';
                li.innerHTML = `<img src="${compShield}" class="competition-icon" alt="Icono de ${record.competition}"><strong>${record.competition}</strong> (${record.wins} títulos)${record.shared ? '*' : ''}`;
                recordsList.appendChild(li);
            });

            if (sharedRecords.length > 0) {
                sharedNote.innerHTML = '*Récord compartido';
            }

            if (champList.children.length === 0) {
                const li = document.createElement('li');
                li.textContent = 'Ninguno.';
                champList.appendChild(li);
            }
            if (runnerList.children.length === 0) {
                const li = document.createElement('li');
                li.textContent = 'Ninguno.';
                runnerList.appendChild(li);
            }
            if (records.length === 0) {
                const li = document.createElement('li');
                li.textContent = 'Ninguno.';
                recordsList.appendChild(li);
            }

            modal.classList.add('visible');
        }

        function copyAchievements(type) {
            let textToCopy = '';
            if (type === 'team') {
                const teamName = document.getElementById('modal-team-name').textContent.replace('Logros de ', '');
                textToCopy += `Logros de ${teamName}\n\n`;
                textToCopy += `Trofeos:\n`;
                document.querySelectorAll('#achievements-list-champ li').forEach(li => {
                    textToCopy += `- ${li.textContent}\n`;
                });
                textToCopy += `\nSubcampeonatos:\n`;
                document.querySelectorAll('#achievements-list-runner li').forEach(li => {
                    textToCopy += `- ${li.textContent}\n`;
                });
                textToCopy += `\nRécords:\n`;
                document.querySelectorAll('#achievements-list-records li').forEach(li => {
                    textToCopy += `- ${li.textContent}\n`;
                });
                textToCopy += `\nPremios:\n`;
                document.querySelectorAll('#achievements-list-awards li').forEach(li => {
                    textToCopy += `- ${li.textContent}\n`;
                });
            } else if (type === 'manager') {
                const managerName = document.getElementById('modal-manager-name').textContent.replace('Logros de ', '');
                textToCopy += `Logros de ${managerName}\n\n`;
                textToCopy += `Trofeos:\n`;
                document.querySelectorAll('#manager-achievements-list-champ li').forEach(li => {
                    textToCopy += `- ${li.textContent}\n`;
                });
                textToCopy += `\nSubcampeonatos:\n`;
                document.querySelectorAll('#manager-achievements-list-runner li').forEach(li => {
                    textToCopy += `- ${li.textContent}\n`;
                });
                textToCopy += `\nRécords:\n`;
                document.querySelectorAll('#manager-achievements-list-records li').forEach(li => {
                    textToCopy += `- ${li.textContent}\n`;
                });
            }

            navigator.clipboard.writeText(textToCopy).then(() => {
                alert('Logros copiados al portapapeles.');
            }, () => {
                alert('Error al copiar al portapapeles.');
            });
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('visible');
        }

        let currentTab = 'clubs';

        function showTab(tab) {
            currentTab = tab;
            const buttons = document.querySelectorAll('.tab-button');
            buttons.forEach(button => {
                button.classList.remove('active');
                if (button.querySelector('span').textContent.includes(tab === 'clubs' ? 'clubes' : tab === 'managers' ? 'mánagers' : 'selecciones')) {
                    button.classList.add('active');
                }
            });
            
            const searchInput = document.getElementById('entities-search');
            if (tab === 'clubs') {
                searchInput.placeholder = `Buscar entre ${allTeams.length} clubes...`;
            } else if (tab === 'managers') {
                searchInput.placeholder = `Buscar entre ${allManagers.length} mánagers...`;
            } else if (tab === 'selections') {
                searchInput.placeholder = `Buscar entre ${allSelections.length} selecciones...`;
            }
            
            filterEntities();
        }

        function openTeamsModal() {
            const modal = document.getElementById('teams-modal');
            modal.classList.add('visible');
            showTab('clubs');
        }

        function filterEntities() {
            const searchValue = normalizeString(document.getElementById('entities-search').value.toLowerCase());
            const entitiesList = document.getElementById('entities-list');
            entitiesList.innerHTML = '';
            let entities;
            if (currentTab === 'clubs') {
                entities = allTeams;
            } else if (currentTab === 'managers') {
                entities = allManagers;
            } else if (currentTab === 'selections') {
                entities = allSelections;
            }
            entities.filter(entity => normalizeString(entity.toLowerCase()).includes(searchValue)).forEach(entity => {
                const li = document.createElement('li');
                if (currentTab === 'clubs' || currentTab === 'selections') {
                    const shieldUrl = shieldsMap[entity];
                    if (shieldUrl) {
                        li.innerHTML = `<img src="${shieldUrl}" width="24" height="24" alt="Escudo de ${entity}" style="margin-right: 0.5rem;"> ${entity}`;
                    } else {
                        li.textContent = entity;
                    }
                } else {
                    li.textContent = entity;
                }
                li.addEventListener('click', () => {
                    if (currentTab === 'clubs' || currentTab === 'selections') {
                        showTeamAchievements(entity);
                    } else if (currentTab === 'managers') {
                        showManagerAchievements(entity);
                    }
                    closeModal('teams-modal');
                });
                entitiesList.appendChild(li);
            });
        }

        function normalizeString(str) {
            return str.normalize('NFD').replace(/[\u0300-\u036f]/g, '');
        }

        document.getElementById('competitions-container').addEventListener('click', (e) => {
            if (e.target.classList.contains('team-cell')) {
                showTeamAchievements(e.target.textContent.trim());
            } else if (e.target.classList.contains('manager-cell')) {
                showManagerAchievements(e.target.textContent.trim());
            }
        });

        document.getElementById('seasons-container').addEventListener('click', (e) => {
            if (e.target.classList.contains('team-cell')) {
                showTeamAchievements(e.target.textContent.trim());
            } else if (e.target.classList.contains('manager-cell')) {
                showManagerAchievements(e.target.textContent.trim());
            }
        });

        document.getElementById('team-achievements-modal').addEventListener('click', (e) => {
            if (e.target === document.getElementById('team-achievements-modal')) {
                closeModal('team-achievements-modal');
            }
        });

        document.getElementById('manager-achievements-modal').addEventListener('click', (e) => {
            if (e.target === document.getElementById('manager-achievements-modal')) {
                closeModal('manager-achievements-modal');
            }
        });

        document.getElementById('teams-modal').addEventListener('click', (e) => {
            if (e.target === document.getElementById('teams-modal')) {
                closeModal('teams-modal');
            }
        });

        document.getElementById('seasons-modal').addEventListener('click', (e) => {
            if (e.target === document.getElementById('seasons-modal')) {
                closeModal('seasons-modal');
            }
        });

        document.getElementById('team-of-year-modal').addEventListener('click', (e) => {
            if (e.target === document.getElementById('team-of-year-modal')) {
                closeModal('team-of-year-modal');
            }
        });

        document.getElementById('ranking-modal').addEventListener('click', (e) => {
            if (e.target === document.getElementById('ranking-modal')) {
                closeModal('ranking-modal');
            }
        });

        function scrollToTop() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        window.addEventListener('scroll', () => {
            const backToTop = document.getElementById('back-to-top');
            if (window.scrollY > 300) {
                backToTop.classList.add('visible');
            } else {
                backToTop.classList.remove('visible');
            }
        });

        let allSeasons = [];
        let currentSeasonIndex = 0;

        async function extractSeasonData() {
            const seasonData = new Map();

            for (const comp of competitions) {
                const tableContainer = document.getElementById(`table-${comp.id}-container`);
                if (tableContainer) {
                    const rows = tableContainer.querySelectorAll('tbody tr');
                    rows.forEach(row => {
                        const seasonCell = row.cells[0].textContent.trim();
                        const [seasonFull] = seasonCell.split('(');
                        const season = seasonFull.trim();

                        if (!seasonData.has(season)) {
                            seasonData.set(season, []);
                        }

                        seasonData.get(season).push({
                            competition: comp.name,
                            competitionId: comp.id,
                            champion: row.cells[1].textContent.trim(),
                            runnerUp: row.cells[2].textContent.trim(),
                            managerChamp: row.cells[3].textContent.trim(),
                            managerRunnerUp: row.cells[4].textContent.trim()
                        });
                    });
                }
            }

            allSeasons = Array.from(seasonData.keys()).sort((a, b) => {
                const numA = parseInt(a.replace('T', ''));
                const numB = parseInt(b.replace('T', ''));
                return numB - numA;
            });
            const container = document.getElementById('seasons-container');
            container.innerHTML = '';
            allSeasons.forEach((season, index) => {
                const seasonHTML = `
                    <div class="season-table ${index === 0 ? 'active' : ''}" id="season-${season}">
                        <div class="season-grid">
                            ${seasonData.get(season).map(comp => {
                                const normalizedCompName = normalizeString(comp.competition.toLowerCase());
                                const shieldUrl = Object.entries(shieldsMap).find(([key]) => normalizeString(key.toLowerCase()) === normalizedCompName)?.[1] || '';
                                const imageHtml = shieldUrl ? `<img src="${shieldUrl}" alt="Logo de ${comp.competition}" style="margin-right: 0.5rem;">` : '';
                                return `
                                    <div class="competition-card">
                                        <h4>${imageHtml}<a href="#${comp.competitionId}" onclick="showCompetition('${comp.competitionId}'); return false;">${comp.competition}</a></h4>
                                        <p><strong>Campeón:</strong> <span class="team-cell">${comp.champion}</span> (<span class="manager-cell">${comp.managerChamp}</span>)</p>
                                        <p><strong>Subcampeón:</strong> <span class="team-cell">${comp.runnerUp}</span> (<span class="manager-cell">${comp.managerRunnerUp}</span>)</p>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                `;
                container.insertAdjacentHTML('beforeend', seasonHTML);
            });

            if (allSeasons.length > 0) {
                currentSeasonIndex = 0;
                showSeason(currentSeasonIndex);
            }
        }

        function showSeason(index) {
            if (index < 0 || index >= allSeasons.length) return;
            currentSeasonIndex = index;

            document.querySelectorAll('.season-table').forEach(table => {
                table.classList.remove('active');
            });

            const activeSeason = document.getElementById(`season-${allSeasons[index]}`);
            if (activeSeason) {
                activeSeason.classList.add('active');
            }
            document.getElementById('current-season').textContent = allSeasons[index];
        }

        function nextSeason() {
            if (allSeasons.length === 0) return;
            if (currentSeasonIndex > 0) {
                currentSeasonIndex--;
                showSeason(currentSeasonIndex);
            }
        }

        function previousSeason() {
            if (allSeasons.length === 0) return;
            if (currentSeasonIndex < allSeasons.length - 1) {
                currentSeasonIndex++;
                showSeason(currentSeasonIndex);
            }
        }

        function goToSeason() {
            const seasonInput = document.getElementById('season-input');
            const seasonNum = parseInt(seasonInput.value);
            const seasonIndex = allSeasons.findIndex(season => parseInt(season.replace('T', '')) === seasonNum);
            if (seasonIndex >= 0) {
                currentSeasonIndex = seasonIndex;
                showSeason(currentSeasonIndex);
                seasonInput.value = '';
            } else {
                alert(`Por favor, introduce un número de temporada válido entre 1 y ${allSeasons.length}`);
            }
        }

        // Función para actualizar las tarjetas superiores con los datos dinámicos del ranking
        function updateTopCards() {
            // Mánager más laureado
            if (rankingData.managers.length > 0) {
                const topManager = rankingData.managers[0].name;
                const managerCardSpan = document.querySelector('.card:first-child p .clickable');
                managerCardSpan.textContent = topManager;
                managerCardSpan.setAttribute('onclick', `showManagerAchievements('${topManager}')`);
                // No cambiamos la imagen del mánager (se mantiene la genérica)
            }

            // Club más laureado
            if (rankingData.clubs.length > 0) {
                const topClub = rankingData.clubs[0].name;
                const clubCardSpan = document.querySelector('.card:nth-child(2) p .clickable');
                clubCardSpan.textContent = topClub;
                clubCardSpan.setAttribute('onclick', `showTeamAchievements('${topClub}')`);
                // Actualizar imagen del escudo si está disponible
                const clubImg = document.querySelector('.card:nth-child(2) img');
                if (shieldsMap[topClub]) {
                    clubImg.src = shieldsMap[topClub];
                }
            }

            // Selección más laureada
            if (rankingData.selections.length > 0) {
                const topSelection = rankingData.selections[0].name;
                const selectionCardSpan = document.querySelector('.card:last-child p .clickable');
                selectionCardSpan.textContent = topSelection;
                selectionCardSpan.setAttribute('onclick', `showTeamAchievements('${topSelection}')`);
                // Actualizar imagen del escudo si está disponible
                const selectionImg = document.querySelector('.card:last-child img');
                if (shieldsMap[topSelection]) {
                    selectionImg.src = shieldsMap[topSelection];
                }
            }
        }

        function initSeasonView() {
            loadCompetitionData().then(() => {
                loadYouthCompetitionData().then(() => {
                    extractSeasonData();
                    populateEntitiesList();
                    // Calcular rankings después de cargar todos los datos
                    calculateRankingData();
                    // Actualizar las tarjetas superiores con los datos del ranking
                    updateTopCards();
                    // Mostrar comparación aleatoria por defecto
                    randomCompare();
                });
            });
        }

        let allEntities = [];
        const entitiesFuseOptions = {
            keys: ['name'],
            threshold: 0.3,
        };
        let entitiesFuse;

        function populateEntitiesList() {
            allTeams.sort((a, b) => a.localeCompare(b));
            allEntities = [
                ...allTeams.map(name => ({ name, type: 'team' })),
                ...allManagers.map(name => ({ name, type: 'manager' })),
                ...allSelections.map(name => ({ name, type: 'selection' }))
            ];
            entitiesFuse = new Fuse(allEntities, entitiesFuseOptions);
        }

        function showEntitySuggestions(inputId, suggestionsId) {
            const input = document.getElementById(inputId);
            const suggestionsList = document.getElementById(suggestionsId);
            suggestionsList.innerHTML = '';
            if (input.value.length > 0) {
                const results = entitiesFuse.search(input.value);
                results.forEach(result => {
                    const li = document.createElement('li');
                    li.textContent = `${result.item.name} (${result.item.type === 'team' ? 'Equipo' : result.item.type === 'manager' ? 'Mánager' : 'Selección'})`;
                    li.addEventListener('click', () => {
                        input.value = result.item.name;
                        suggestionsList.classList.remove('visible');
                        compareEntities();
                    });
                    suggestionsList.appendChild(li);
                });
                suggestionsList.classList.add('visible');
            } else {
                suggestionsList.classList.remove('visible');
            }
        }

        document.getElementById('entity1').addEventListener('input', () => showEntitySuggestions('entity1', 'entity1-suggestions'));
        document.getElementById('entity2').addEventListener('input', () => showEntitySuggestions('entity2', 'entity2-suggestions'));

        document.getElementById('entity1').addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                compareEntities();
            }
        });
        document.getElementById('entity2').addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                compareEntities();
            }
        });

        function calculateEntityStats(entityName) {
            const stats = { championships: 0, runnerups: 0, type: null, details: {} };
            competitions.forEach(comp => {
                const tableContainer = document.getElementById(`table-${comp.id}-container`);
                if (tableContainer) {
                    const rows = tableContainer.querySelectorAll('tbody tr');
                    rows.forEach(row => {
                        const champion = row.cells[1].textContent.trim();
                        const runnerUp = row.cells[2].textContent.trim();
                        const managerChamp = row.cells[3].textContent.trim().replace(/[@"]/g, '');
                        const managerRunnerUp = row.cells[4].textContent.trim().replace(/[@"]/g, '');
                        const season = row.cells[0].textContent.trim().split('(')[0].trim();

                        if (champion === entityName || runnerUp === entityName) {
                            stats.type = 'team';
                            if (champion === entityName) {
                                stats.championships++;
                                if (!stats.details[comp.name]) stats.details[comp.name] = { champ: [], runner: [] };
                                stats.details[comp.name].champ.push(season);
                            }
                            if (runnerUp === entityName) {
                                stats.runnerups++;
                                if (!stats.details[comp.name]) stats.details[comp.name] = { champ: [], runner: [] };
                                stats.details[comp.name].runner.push(season);
                            }
                        }
                        if (managerChamp === entityName || managerRunnerUp === entityName) {
                            stats.type = 'manager';
                            if (managerChamp === entityName) {
                                stats.championships++;
                                if (!stats.details[comp.name]) stats.details[comp.name] = { champ: [], runner: [] };
                                stats.details[comp.name].champ.push(season);
                            }
                            if (managerRunnerUp === entityName) {
                                stats.runnerups++;
                                if (!stats.details[comp.name]) stats.details[comp.name] = { champ: [], runner: [] };
                                stats.details[comp.name].runner.push(season);
                            }
                        }
                    });
                }
            });
            return stats;
        }

        function compareEntities() {
            const entity1 = document.getElementById('entity1').value.trim();
            const entity2 = document.getElementById('entity2').value.trim();
            if (!entity1 || !entity2) {
                alert('Por favor, selecciona dos entidades para comparar.');
                return;
            }
            if (entity1 === entity2) {
                alert('Por favor, selecciona dos entidades diferentes.');
                return;
            }

            const stats1 = calculateEntityStats(entity1);
            const stats2 = calculateEntityStats(entity2);
            const resultsContainer = document.getElementById('comparison-results');
            resultsContainer.innerHTML = '';

            const maxChamp = Math.max(stats1.championships, stats2.championships) || 1;
            const maxRunner = Math.max(stats1.runnerups, stats2.runnerups) || 1;
            const champPercent1 = (stats1.championships / maxChamp) * 50;
            const champPercent2 = (stats2.championships / maxChamp) * 50;
            const runnerPercent1 = (stats1.runnerups / maxRunner) * 50;
            const runnerPercent2 = (stats2.runnerups / maxRunner) * 50;

            resultsContainer.innerHTML = `
                <div class="comparison-bar-container">
                    <div class="comparison-bar-title">Campeonatos</div>
                    <div class="comparison-bar" style="background: linear-gradient(90deg, var(--accent-color) ${champPercent1}%, var(--primary-light) ${100 - champPercent2}%);"></div>
                    <div class="comparison-legend">
                        <span class="entity1">${entity1}: ${stats1.championships}</span>
                        <span class="entity2">${entity2}: ${stats2.championships}</span>
                    </div>
                </div>
                <div class="comparison-bar-container">
                    <div class="comparison-bar-title">Subcampeonatos</div>
                    <div class="comparison-bar" style="background: linear-gradient(90deg, var(--accent-color) ${runnerPercent1}%, var(--primary-light) ${100 - runnerPercent2}%);"></div>
                    <div class="comparison-legend">
                        <span class="entity1">${entity1}: ${stats1.runnerups}</span>
                        <span class="entity2">${entity2}: ${stats2.runnerups}</span>
                    </div>
                </div>
                <span class="more-details" onclick="toggleDetailedComparison()">Ver más</span>
                <div class="detailed-comparison" id="detailed-comparison">
                    <table>
                        <thead>
                            <tr>
                                <th>Competición</th>
                                <th>${entity1} Cam</th>
                                <th>${entity1} Sub</th>
                                <th>${entity2} Cam</th>
                                <th>${entity2} Sub</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${Object.keys({ ...stats1.details, ...stats2.details }).map(compName => {
                                const detail1 = stats1.details[compName] || { champ: [], runner: [] };
                                const detail2 = stats2.details[compName] || { champ: [], runner: [] };
                                if (detail1.champ.length > 0 || detail1.runner.length > 0 || detail2.champ.length > 0 || detail2.runner.length > 0) {
                                    const champClass1 = detail1.champ.length > detail2.champ.length ? 'cam-highlight' : '';
                                    const champClass2 = detail2.champ.length > detail1.champ.length ? 'cam-highlight' : '';
                                    const runnerClass1 = detail1.runner.length > detail2.runner.length ? 'sub-highlight' : '';
                                    const runnerClass2 = detail2.runner.length > detail1.runner.length ? 'sub-highlight' : '';
                                    
                                    // Crear tooltips con las temporadas
                                    const title1 = detail1.champ.length > 0 ? `Campeonatos: ${formatSeasons(detail1.champ)}` : '';
                                    const title1sub = detail1.runner.length > 0 ? `Subcampeonatos: ${formatSeasons(detail1.runner)}` : '';
                                    const title2 = detail2.champ.length > 0 ? `Campeonatos: ${formatSeasons(detail2.champ)}` : '';
                                    const title2sub = detail2.runner.length > 0 ? `Subcampeonatos: ${formatSeasons(detail2.runner)}` : '';
                                    
                                    return `
                                        <tr>
                                            <td>${compName}</td>
                                            <td class="${champClass1}" ${detail1.champ.length ? `title="${title1}"` : ''}>${detail1.champ.length}</td>
                                            <td class="${runnerClass1}" ${detail1.runner.length ? `title="${title1sub}"` : ''}>${detail1.runner.length}</td>
                                            <td class="${champClass2}" ${detail2.champ.length ? `title="${title2}"` : ''}>${detail2.champ.length}</td>
                                            <td class="${runnerClass2}" ${detail2.runner.length ? `title="${title2sub}"` : ''}>${detail2.runner.length}</td>
                                        </tr>
                                    `;
                                }
                                return '';
                            }).join('')}
                        </tbody>
                    </table>
                </div>
            `;

            resultsContainer.classList.add('visible');
            // Asegurar que la tabla detallada esté oculta inicialmente
            document.getElementById('detailed-comparison').classList.remove('visible');
        }

        function toggleDetailedComparison() {
            const detailedComparison = document.getElementById('detailed-comparison');
            detailedComparison.classList.toggle('visible');
            const moreDetails = document.querySelector('.more-details');
            moreDetails.textContent = detailedComparison.classList.contains('visible') ? 'Cerrar' : 'Ver más';
        }

        function randomCompare() {
            const entity1Options = ['Arsenal', 'Barcelona', 'Juventus', 'Real Madrid'];
            const entity2Options = ['Chelsea', 'Manchester City', 'Milan', 'PSG'];
            const randomEntity1 = entity1Options[Math.floor(Math.random() * entity1Options.length)];
            const randomEntity2 = entity2Options[Math.floor(Math.random() * entity2Options.length)];
            document.getElementById('entity1').value = randomEntity1;
            document.getElementById('entity2').value = randomEntity2;
            compareEntities();
        }

        function resetComparison() {
            document.getElementById('entity1').value = '';
            document.getElementById('entity2').value = '';
            document.getElementById('comparison-results').classList.remove('visible');
            document.getElementById('comparison-results').innerHTML = '';
        }

        let evolutionCharts = {};
        let evolutionIntervals = {};
        let evolutionSpeeds = {};
        let evolutionStates = {};

        function toggleEvolution(evolutionId) {
            const evolutionElement = document.getElementById(evolutionId);
            const compId = evolutionId.replace('evolution-', '');
            if (evolutionElement.classList.contains('hidden')) {
                evolutionElement.classList.remove('hidden');
                setTimeout(() => {
                    evolutionElement.classList.add('visible');
                    evolutionElement.scrollIntoView({ behavior: 'smooth' });
                }, 10);
                if (evolutionElement.getAttribute('data-calculated') === 'false') {
                    createEvolutionChart(compId);
                    evolutionElement.setAttribute('data-calculated', 'true');
                }
            } else {
                evolutionElement.classList.remove('visible');
                pauseEvolution(compId);
                setTimeout(() => {
                    evolutionElement.classList.add('hidden');
                }, 500);
            }
        }

        function setupEvolutionSpeedControls(compId) {
            const speedButtons = document.querySelectorAll(`#evolution-${compId} .speed-btn`);
            speedButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    speedButtons.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    const speed = parseInt(this.getAttribute('data-speed'));
                    evolutionSpeeds[compId] = speed;

                    if (evolutionStates[compId] && evolutionStates[compId].playing) {
                        pauseEvolution(compId);
                        playEvolution(compId);
                    }
                });
            });
        }

        function createEvolutionChart(compId) {
            const tableContainer = document.getElementById(`table-${compId}-container`);
            const rows = tableContainer.querySelectorAll('tbody tr');
            const seasonData = [];
            rows.forEach(row => {
                const season = row.cells[0].textContent.trim().split('(')[0].trim();
                const champion = row.cells[1].textContent.trim();
                seasonData.push({ season, champion });
            });

            const teamTitles = {};
            seasonData.forEach((data, index) => {
                if (!teamTitles[data.champion]) {
                    teamTitles[data.champion] = new Array(seasonData.length).fill(0);
                }
                teamTitles[data.champion][index]++;
                for (let i = index; i < seasonData.length; i++) {
                    teamTitles[data.champion][i] = (teamTitles[data.champion][i - 1] || 0) + teamTitles[data.champion][index];
                }
            });

            const ctx = document.getElementById(`evolution-chart-${compId}`).getContext('2d');
            const teams = Object.keys(teamTitles);
            const initialData = {
                labels: teams,
                datasets: [{
                    label: 'Campeonatos',
                    data: new Array(teams.length).fill(0),
                    backgroundColor: teams.map(() => getRandomColor()),
                    borderColor: teams.map(() => getRandomColor()),
                    borderWidth: 1
                }]
            };

            evolutionCharts[compId] = new Chart(ctx, {
                type: 'bar',
                data: initialData,
                options: {
                    indexAxis: 'y',
                    scales: {
                        x: {
                            beginAtZero: true,
                            title: { display: true, text: 'Campeonatos' },
                            ticks: {
                                stepSize: 1
                            }
                        },
                        y: {
                            title: { display: true, text: 'Equipos' },
                            stacked: false
                        }
                    },
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.label}: ${context.raw} campeonatos`;
                                }
                            }
                        }
                    },
                    animation: {
                        duration: 500,
                        easing: 'easeInOutQuad'
                    }
                }
            });

            evolutionCharts[compId].seasonData = seasonData;
            evolutionCharts[compId].teamTitles = teamTitles;
            evolutionCharts[compId].totalEditions = seasonData.length;

            evolutionStates[compId] = {
                playing: false,
                currentEdition: 0,
                maxEditions: seasonData.length
            };

            const slider = document.getElementById(`timeline-${compId}`);
            slider.max = seasonData.length - 1;
            slider.value = 0;

            setupEvolutionSpeedControls(compId);
        }

        function playEvolution(compId) {
            const chart = evolutionCharts[compId];
            if (!chart) return;

            pauseEvolution(compId);

            evolutionStates[compId].playing = true;
            updatePlayPauseButton(compId);

            let currentEdition = evolutionStates[compId].currentEdition;
            const maxEditions = chart.totalEditions;

            let speed = evolutionSpeeds[compId] || 500;

            evolutionIntervals[compId] = setInterval(() => {
                if (currentEdition >= maxEditions) {
                    clearInterval(evolutionIntervals[compId]);
                    evolutionStates[compId].playing = false;
                    updatePlayPauseButton(compId);
                    return;
                }

                updateChartToEdition(compId, currentEdition);
                currentEdition++;
                evolutionStates[compId].currentEdition = currentEdition;
                
                const slider = document.getElementById(`timeline-${compId}`);
                slider.value = currentEdition;

            }, speed);
        }

        function pauseEvolution(compId) {
            if (evolutionIntervals[compId]) {
                clearInterval(evolutionIntervals[compId]);
                delete evolutionIntervals[compId];
            }
            if (evolutionStates[compId]) {
                evolutionStates[compId].playing = false;
                updatePlayPauseButton(compId);
            }
        }

        function togglePlayPause(compId) {
            if (evolutionStates[compId] && evolutionStates[compId].playing) {
                pauseEvolution(compId);
            } else {
                playEvolution(compId);
            }
        }

        function updatePlayPauseButton(compId) {
            const button = document.getElementById(`play-pause-${compId}`);
            if (!button) return;
            
            if (evolutionStates[compId] && evolutionStates[compId].playing) {
                button.innerHTML = '<i class="fas fa-pause"></i> Pausar';
            } else {
                button.innerHTML = '<i class="fas fa-play"></i> Play';
            }
        }

        function seekEvolution(compId, value) {
            const chart = evolutionCharts[compId];
            if (!chart) return;
            
            const edition = parseInt(value);
            if (edition >= 0 && edition < chart.totalEditions) {
                pauseEvolution(compId);
                updateChartToEdition(compId, edition);
                evolutionStates[compId].currentEdition = edition;
                document.getElementById(`timeline-${compId}`).value = edition;
            }
        }

        function updateChartToEdition(compId, edition) {
            const chart = evolutionCharts[compId];
            if (!chart) return;

            const teamsWithTitles = [];
            const titlesUpToEdition = {};
            for (let i = 0; i <= edition; i++) {
                const champion = chart.seasonData[i].champion;
                if (!titlesUpToEdition[champion]) {
                    titlesUpToEdition[champion] = 0;
                    teamsWithTitles.push(champion);
                }
                titlesUpToEdition[champion]++;
            }

            const sortedTeams = teamsWithTitles.sort((a, b) => {
                const titlesA = titlesUpToEdition[a];
                const titlesB = titlesUpToEdition[b];
                return titlesB - titlesA || a.localeCompare(b);
            });

            chart.data.labels = sortedTeams;
            chart.data.datasets[0].data = sortedTeams.map(team => titlesUpToEdition[team]);
            chart.data.datasets[0].backgroundColor = sortedTeams.map(team => chart.data.datasets[0].backgroundColor[Object.keys(chart.teamTitles).indexOf(team)] || getRandomColor());
            chart.data.datasets[0].borderColor = chart.data.datasets[0].backgroundColor;

            chart.update();

            document.getElementById(`edition-indicator-${compId}`).textContent = `Edición: ${edition + 1}`;
        }
        
        function getRandomColor() {
            const letters = '0123456789ABCDEF';
            let color = '#';
            for (let i = 0; i < 6; i++) {
                color += letters[Math.floor(Math.random() * 16)];
            }
            return color;
        }

        function initDarkMode() {
            const darkModeToggle = document.getElementById('dark-mode-toggle');
            const icon = darkModeToggle.querySelector('i');

            const savedMode = localStorage.getItem('darkMode');
            const systemPrefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;

            if (savedMode === 'dark' || (!savedMode && systemPrefersDark)) {
                document.body.classList.add('dark-mode');
                icon.className = 'fas fa-sun';
            }

            darkModeToggle.addEventListener('click', () => {
                document.body.classList.toggle('dark-mode');
                if (document.body.classList.contains('dark-mode')) {
                    icon.className = 'fas fa-sun';
                    localStorage.setItem('darkMode', 'dark');
                } else {
                    icon.className = 'fas fa-moon';
                    localStorage.setItem('darkMode', 'light');
                }
            });
        }

        async function showSeasonsModal() {
            const modal = document.getElementById('seasons-modal');
            const listContainer = document.getElementById('seasons-list');

            try {
                const response = await fetch('https://www.tusoccermanager.com/h115-seasonbyseason-html');
                if (!response.ok) throw new Error('No se pudo cargar la información');
                const html = await response.text();
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');
                const preContent = doc.querySelector('pre');

                if (preContent) {
                    const lines = preContent.textContent.split('\n').filter(line => line.trim());
                    const formattedList = lines.map(line => {
                        const cleanedLine = line.trim().replace('Temporada ', '');
                        return `<div style="padding: 0.5rem 0; border-bottom: 1px solid var(--border-color);">
                                    <strong style="color: var(--accent-color);">${cleanedLine}</strong>
                                </div>`;
                    }).join('');
                    listContainer.innerHTML = formattedList;
                } else {
                    listContainer.innerHTML = '<p>No se encontró la información de temporadas.</p>';
                }
            } catch (error) {
                console.error('Error al cargar temporadas:', error);
                listContainer.innerHTML = '<p>No se pudo cargar la información de temporadas. Por favor, inténtalo más tarde.</p>';
            }

            modal.classList.add('visible');
        }

        async function showTeamOfYearModal() {
            const modal = document.getElementById('team-of-year-modal');
            const listContainer = document.getElementById('team-of-year-list');

            try {
                const response = await fetch('https://www.tusoccermanager.com/h116-teamoftheyear-html');
                if (!response.ok) throw new Error('No se pudo cargar la información');
                const html = await response.text();
                const parser = new DOMParser();
                const doc = parser.parseFromString(html, 'text/html');
                const preContent = doc.querySelector('pre');

                if (preContent) {
                    const lines = preContent.textContent.split('\n').filter(line => line.trim());
                    const formattedList = lines.map(line => {
                        const cleanedLine = line.trim().replace('Temporada ', '');
                        return `<div style="padding: 0.5rem 0; border-bottom: 1px solid var(--border-color);">
                                    <strong style="color: var(--accent-color);">${cleanedLine}</strong>
                                </div>`;
                    }).join('');
                    listContainer.innerHTML = formattedList;
                } else {
                    listContainer.innerHTML = '<p>No se encontró la información del equipo del año.</p>';
                }
            } catch (error) {
                console.error('Error al cargar equipo del año:', error);
                listContainer.innerHTML = '<p>No se pudo cargar la información del equipo del año. Por favor, inténtalo más tarde.</p>';
            }

            modal.classList.add('visible');
        }

        function calculateRankingData() {
            // Clubes: solo competiciones senior (índices 0-40)
            const clubStats = {};
            competitions.slice(0, 41).forEach(comp => {
                const tableContainer = document.getElementById(`table-${comp.id}-container`);
                if (tableContainer) {
                    const rows = tableContainer.querySelectorAll('tbody tr');
                    rows.forEach(row => {
                        const champion = row.cells[1].textContent.trim();
                        clubStats[champion] = (clubStats[champion] || 0) + 1;
                    });
                }
            });
            
            rankingData.clubs = Object.entries(clubStats)
                .map(([name, trophies]) => ({ name, trophies }))
                .sort((a, b) => b.trophies - a.trophies);

            // Mánagers: todas las competiciones excepto las de filiales/femeninas (índices 0-48)
            const managerStats = {};
            competitions.slice(0, 49).forEach(comp => {
                const tableContainer = document.getElementById(`table-${comp.id}-container`);
                if (tableContainer) {
                    const rows = tableContainer.querySelectorAll('tbody tr');
                    rows.forEach(row => {
                        const managerChamp = row.cells[3].textContent.trim().replace(/[@"]/g, '');
                        managerStats[managerChamp] = (managerStats[managerChamp] || 0) + 1;
                    });
                }
            });
            
            rankingData.managers = Object.entries(managerStats)
                .map(([name, trophies]) => ({ name, trophies }))
                .sort((a, b) => b.trophies - a.trophies);

            // Selecciones: solo competiciones nacionales (índices 41-48)
            const selectionStats = {};
            competitions.slice(41, 49).forEach(comp => {
                const tableContainer = document.getElementById(`table-${comp.id}-container`);
                if (tableContainer) {
                    const rows = tableContainer.querySelectorAll('tbody tr');
                    rows.forEach(row => {
                        const champion = row.cells[1].textContent.trim();
                        // Solo contar si el campeón es una selección (está en allSelections)
                        if (allSelections.includes(champion)) {
                            selectionStats[champion] = (selectionStats[champion] || 0) + 1;
                        }
                    });
                }
            });
            
            rankingData.selections = Object.entries(selectionStats)
                .map(([name, trophies]) => ({ name, trophies }))
                .sort((a, b) => b.trophies - a.trophies);
        }

        function showRankingModal() {
            const modal = document.getElementById('ranking-modal');
            modal.classList.add('visible');
            showRankingTab('clubs');
        }

        function showRankingTab(tab) {
            currentRankingTab = tab;
            const buttons = document.querySelectorAll('#ranking-modal .tab-button');
            buttons.forEach(button => {
                button.classList.remove('active');
                if (button.querySelector('span').textContent.includes(tab === 'clubs' ? 'Clubes' : tab === 'managers' ? 'Mánagers' : 'Selecciones')) {
                    button.classList.add('active');
                }
            });
            
            const searchInput = document.getElementById('ranking-search');
            let count = 0;
            if (tab === 'clubs') {
                count = rankingData.clubs.length;
                searchInput.placeholder = `Buscar entre ${count} clubes...`;
            } else if (tab === 'managers') {
                count = rankingData.managers.length;
                searchInput.placeholder = `Buscar entre ${count} mánagers...`;
            } else if (tab === 'selections') {
                count = rankingData.selections.length;
                searchInput.placeholder = `Buscar entre ${count} selecciones...`;
            }
            
            filterRanking();
        }

        function filterRanking() {
            const searchValue = normalizeString(document.getElementById('ranking-search').value.toLowerCase());
            const rankingList = document.getElementById('ranking-list');
            rankingList.innerHTML = '';
            
            let data;
            if (currentRankingTab === 'clubs') {
                data = rankingData.clubs;
            } else if (currentRankingTab === 'managers') {
                data = rankingData.managers;
            } else if (currentRankingTab === 'selections') {
                data = rankingData.selections;
            }
            
            const filteredData = data.filter(item => 
                normalizeString(item.name.toLowerCase()).includes(searchValue)
            );
            
            filteredData.forEach((item, index) => {
                const li = document.createElement('li');
                li.className = 'ranking-list-item';
                
                const position = data.findIndex(d => d.name === item.name) + 1;
                
                let shieldHtml = '';
                if (currentRankingTab === 'clubs' || currentRankingTab === 'selections') {
                    const shieldUrl = shieldsMap[item.name];
                    if (shieldUrl) {
                        shieldHtml = `<img src="${shieldUrl}" width="32" height="32" alt="Escudo de ${item.name}" style="margin-right: 1rem;">`;
                    }
                }
                
                li.innerHTML = `
                    <div class="ranking-position">${position}</div>
                    ${shieldHtml}
                    <div class="ranking-name">${item.name}</div>
                    <div class="ranking-trophies">${item.trophies} trofeos</div>
                `;
                
                li.addEventListener('click', () => {
                    if (currentRankingTab === 'clubs' || currentRankingTab === 'selections') {
                        showTeamAchievements(item.name);
                    } else if (currentRankingTab === 'managers') {
                        showManagerAchievements(item.name);
                    }
                    closeModal('ranking-modal');
                });
                
                rankingList.appendChild(li);
            });
            
            if (filteredData.length === 0) {
                const li = document.createElement('li');
                li.className = 'ranking-list-item';
                li.innerHTML = `<div class="ranking-name" style="text-align: center; width: 100%;">No se encontraron resultados</div>`;
                rankingList.appendChild(li);
            }
        }
    </script>
</body>
</html>
